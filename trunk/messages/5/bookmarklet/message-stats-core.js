var getKeys=function(a){var b=[],e;for(e in a)b.push(e);return b},fixQuot=function(a){return browser.msie?a.replace(/\"/g,"&quot;"):a},nKeys=function(a){var b=0,e;for(e in a)b++;return b},splitArrayToSubArrays=function(a,b){for(var e=[],c=0;c<a.length/b;c++)e.push(a.slice(b*c,b*(c+1)));return e},formatDate=function(a,b){var e=a.getFullYear(),c=a.getMonth()+1;c<10&&(c="0"+c);var j=a.getDate();j<10&&(j="0"+j);var i=a.getHours();i<10&&(i="0"+i);var d=a.getMinutes();d<10&&(d="0"+d);var f=a.getSeconds();
f<10&&(f="0"+f);if(b){var g=mod(a.getTime(),1E3);g<100&&(g="0"+g);intval(g)<10&&(g="0"+g);f=f+"."+g}return e+"-"+c+"-"+j+" "+i+":"+d+":"+f},insertAfter=function(a,b){var e=b.nextSibling;e?e.parentNode.insertBefore(a,e):b.parentNode.appendChild(a)},mod=function(a,b){return a%b},to_json=function(a){var b=typeof a;if(b!="object"||a===null)return b=="string"&&(a='"'+a+'"'),String(a);else{var e,c,j=[],i=a&&a.constructor==Array;for(e in a)c=a[e],b=typeof c,b=="string"?c='"'+c+'"':b=="object"&&c!==null&&
(c=JSON.stringify(c)),j.push((i?"":'"'+e+'":')+String(c));return(i?"[":"{")+String(j)+(i?"]":"}")}},myCheckChange=function(a,b){if(!cur.messChecked)cur.messChecked={};if(cur.messCheckedNum==null)cur.messCheckedNum=0;mail.checkChange(a,b);(cur.messCheckedNum>0?hide:show)("vkstats_text");cur.messCheckedNum>SYS.MAX_USERS_AT_ONE_GRAPH?user.plotGraphs&&hide("plot_graphs_links"):user.plotGraphs&&show("plot_graphs_links")},rotateLeft=function(a,b){return a<<b|a>>>32-b},addUnsigned=function(a,b){var e,c,
j,i,d;j=a&2147483648;i=b&2147483648;e=a&1073741824;c=b&1073741824;d=(a&1073741823)+(b&1073741823);if(e&c)return d^2147483648^j^i;return e|c?d&1073741824?d^3221225472^j^i:d^1073741824^j^i:d^j^i},F=function(a,b,e){return a&b|~a&e},G=function(a,b,e){return a&e|b&~e},H=function(a,b,e){return a^b^e},I=function(a,b,e){return b^(a|~e)},FF=function(a,b,e,c,j,i,d){a=addUnsigned(a,addUnsigned(addUnsigned(F(b,e,c),j),d));return addUnsigned(rotateLeft(a,i),b)},GG=function(a,b,e,c,j,i,d){a=addUnsigned(a,addUnsigned(addUnsigned(G(b,
e,c),j),d));return addUnsigned(rotateLeft(a,i),b)},HH=function(a,b,e,c,j,i,d){a=addUnsigned(a,addUnsigned(addUnsigned(H(b,e,c),j),d));return addUnsigned(rotateLeft(a,i),b)},II=function(a,b,e,c,j,i,d){a=addUnsigned(a,addUnsigned(addUnsigned(I(b,e,c),j),d));return addUnsigned(rotateLeft(a,i),b)},convertToWordArray=function(a){var b,e=a.length;b=e+8;for(var c=((b-mod(b,64))/64+1)*16,j=Array(c-1),i=0,d=0;d<e;)b=(d-mod(d,4))/4,i=mod(d,4)*8,j[b]|=a.charCodeAt(d)<<i,d++;b=(d-mod(d,4))/4;i=mod(d,4)*8;j[b]|=
128<<i;j[c-2]=e<<3;j[c-1]=e>>>29;return j},wordToHex=function(a){var b="",e="",c;for(c=0;c<=3;c++)e=a>>>c*8&255,e="0"+e.toString(16),b+=e.substr(e.length-2,2);return b},uTF8Encode=function(a){for(var a=a.replace(/\x0d\x0a/g,"\n"),b="",e=0;e<a.length;e++){var c=a.charCodeAt(e);c<128?b+=String.fromCharCode(c):(c>127&&c<2048?b+=String.fromCharCode(c>>6|192):(b+=String.fromCharCode(c>>12|224),b+=String.fromCharCode(c>>6&63|128)),b+=String.fromCharCode(c&63|128))}return b},md5=function(a){var b=[],e,c,
j,i,d,f,g,h,a=uTF8Encode(a),b=convertToWordArray(a);d=1732584193;f=4023233417;g=2562383102;h=271733878;for(a=0;a<b.length;a+=16)e=d,c=f,j=g,i=h,d=FF(d,f,g,h,b[a+0],7,3614090360),h=FF(h,d,f,g,b[a+1],12,3905402710),g=FF(g,h,d,f,b[a+2],17,606105819),f=FF(f,g,h,d,b[a+3],22,3250441966),d=FF(d,f,g,h,b[a+4],7,4118548399),h=FF(h,d,f,g,b[a+5],12,1200080426),g=FF(g,h,d,f,b[a+6],17,2821735955),f=FF(f,g,h,d,b[a+7],22,4249261313),d=FF(d,f,g,h,b[a+8],7,1770035416),h=FF(h,d,f,g,b[a+9],12,2336552879),g=FF(g,h,d,
f,b[a+10],17,4294925233),f=FF(f,g,h,d,b[a+11],22,2304563134),d=FF(d,f,g,h,b[a+12],7,1804603682),h=FF(h,d,f,g,b[a+13],12,4254626195),g=FF(g,h,d,f,b[a+14],17,2792965006),f=FF(f,g,h,d,b[a+15],22,1236535329),d=GG(d,f,g,h,b[a+1],5,4129170786),h=GG(h,d,f,g,b[a+6],9,3225465664),g=GG(g,h,d,f,b[a+11],14,643717713),f=GG(f,g,h,d,b[a+0],20,3921069994),d=GG(d,f,g,h,b[a+5],5,3593408605),h=GG(h,d,f,g,b[a+10],9,38016083),g=GG(g,h,d,f,b[a+15],14,3634488961),f=GG(f,g,h,d,b[a+4],20,3889429448),d=GG(d,f,g,h,b[a+9],5,
568446438),h=GG(h,d,f,g,b[a+14],9,3275163606),g=GG(g,h,d,f,b[a+3],14,4107603335),f=GG(f,g,h,d,b[a+8],20,1163531501),d=GG(d,f,g,h,b[a+13],5,2850285829),h=GG(h,d,f,g,b[a+2],9,4243563512),g=GG(g,h,d,f,b[a+7],14,1735328473),f=GG(f,g,h,d,b[a+12],20,2368359562),d=HH(d,f,g,h,b[a+5],4,4294588738),h=HH(h,d,f,g,b[a+8],11,2272392833),g=HH(g,h,d,f,b[a+11],16,1839030562),f=HH(f,g,h,d,b[a+14],23,4259657740),d=HH(d,f,g,h,b[a+1],4,2763975236),h=HH(h,d,f,g,b[a+4],11,1272893353),g=HH(g,h,d,f,b[a+7],16,4139469664),
f=HH(f,g,h,d,b[a+10],23,3200236656),d=HH(d,f,g,h,b[a+13],4,681279174),h=HH(h,d,f,g,b[a+0],11,3936430074),g=HH(g,h,d,f,b[a+3],16,3572445317),f=HH(f,g,h,d,b[a+6],23,76029189),d=HH(d,f,g,h,b[a+9],4,3654602809),h=HH(h,d,f,g,b[a+12],11,3873151461),g=HH(g,h,d,f,b[a+15],16,530742520),f=HH(f,g,h,d,b[a+2],23,3299628645),d=II(d,f,g,h,b[a+0],6,4096336452),h=II(h,d,f,g,b[a+7],10,1126891415),g=II(g,h,d,f,b[a+14],15,2878612391),f=II(f,g,h,d,b[a+5],21,4237533241),d=II(d,f,g,h,b[a+12],6,1700485571),h=II(h,d,f,g,
b[a+3],10,2399980690),g=II(g,h,d,f,b[a+10],15,4293915773),f=II(f,g,h,d,b[a+1],21,2240044497),d=II(d,f,g,h,b[a+8],6,1873313359),h=II(h,d,f,g,b[a+15],10,4264355552),g=II(g,h,d,f,b[a+6],15,2734768916),f=II(f,g,h,d,b[a+13],21,1309151649),d=II(d,f,g,h,b[a+4],6,4149444226),h=II(h,d,f,g,b[a+11],10,3174756917),g=II(g,h,d,f,b[a+2],15,718787259),f=II(f,g,h,d,b[a+9],21,3951481745),d=addUnsigned(d,e),f=addUnsigned(f,c),g=addUnsigned(g,j),h=addUnsigned(h,i);return(wordToHex(d)+wordToHex(f)+wordToHex(g)+wordToHex(h)).toLowerCase()},
SYS={VERSION:"4.2.1",APP_ID:2045168,LOGIN_SETTING:6144,DEBUG:!1,MESSAGES_TO_PROCESS_IN_DEBUG_MODE:400,MESSAGES_PER_REQUEST:1E3,MSEC_BETWEEN_REQUESTS:333,MSEC_BETWEEN_REQUESTS_FOR_USERDATA:1E3,MAX_USERS_PER_REQUEST:1E3,LINK_TO_CLUB:"/club21792535",TOO_MANY_REQUESTS_ERR_CODE:6,MAX_USERS_AT_ONE_GRAPH:3,FILES_TO_LOAD:["mail.css","mail.js","ui_controls.js","ui_controls.css","common.js"],LANGUAGES:{0:{name:"russian",strings:{authorizing:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f",
authorized:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",loadingMessageNumbers:"\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0447\u0438\u0441\u043b\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",fatal:"\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0441\u043e\u043e\u0431\u0449\u0438\u0442\u0435 \u043f\u0440\u0438\u0432\u0435\u0434\u0451\u043d\u043d\u044b\u0435 \u043d\u0438\u0436\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443.",
appName:"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0438\u0447\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0438",nameCol:"\u0418\u043c\u044f",kbytes:"\u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",settingsText:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0436\u0435\u043b\u0430\u0435\u043c\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b",
startButton:"\u041f\u043e\u0435\u0445\u0430\u043b\u0438!",verbose:"\u041b\u043e\u0433\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f",gettingNames:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u043c\u0451\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439",numberOfMessagesCol:"\u0412\u0441\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",sentCol:"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e",
receivedCol:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e",symbolsCol:"\u0412\u0441\u0435\u0433\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",sentSymbolsCol:"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",receivedSymbolsCol:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",lastMsgCol:"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",
processingMessages:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",done:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",messagesProcessed:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",incoming:"\u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445",outgoing:"\u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0445",
dayWithMostMessages:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0432\u0441\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0431\u044b\u043b\u043e",timeWithMostMessages:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0432\u0441\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",thankYou:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e, \u0447\u0442\u043e \u0434\u043e\u0436\u0434\u0430\u043b\u0438\u0441\u044c, \u043d\u0430\u0434\u0435\u0435\u043c\u0441\u044f, \u043e\u043d\u043e \u0442\u043e\u0433\u043e \u0441\u0442\u043e\u0438\u043b\u043e!",
exportByTime:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u043f\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438",exportByMessages:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u043f\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u043c",warning:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",
friendsOnly:"\u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u0440\u0443\u0437\u0435\u0439",withSelected:"\u0412\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0435",exportToNote:"\u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0437\u0430\u043c\u0435\u0442\u043a\u0443",ourGroup:"\u041d\u0430\u0448\u0430 \u0433\u0440\u0443\u043f\u043f\u0430",noteSuccess:"\u0417\u0430\u043c\u0435\u0442\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0430",
noteFailure:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u043c\u0435\u0442\u043a\u0443. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437 \u043f\u043e\u0437\u0434\u043d\u0435\u0435.",seeNote:"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c",plotKbytesGraph:"\u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a \u043f\u043e \u0447\u0438\u0441\u043b\u0443 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",
plotMessagesGraph:"\u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a \u043f\u043e \u0447\u0438\u0441\u043b\u0443 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",wantToPlotGraphs:"\u042f \u0437\u0430\u0445\u043e\u0447\u0443 \u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a\u0438 \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043e\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438",totalFirstName:"\u041e\u0431\u0449\u0430\u044f",
totalLastName:"\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430",sortByKBytes:"\u0421\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u043a\u0438\u043b\u043e\u0431\u0430\u0439\u0442\u0430\u043c",hideAvatars:"\u041d\u0435 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439"}},1:{name:"ukrainian",strings:{authorizing:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u044f",
authorized:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",loadingMessageNumbers:"\u0412\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u044f \u043a\u0456\u043b\u044c\u043a\u043e\u0441\u0442\u0456 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",settingsText:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u0431\u0430\u0436\u0430\u043d\u0456 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0438",startButton:"\u041f\u043e\u0457\u0445\u0430\u043b\u0438!",
verbose:"\u041b\u043e\u0433\u0443\u0432\u0430\u0442\u0438 \u0432\u0441\u0456 \u0434\u0456\u0457",fatal:"\u041a\u0440\u0438\u0442\u0438\u0447\u043d\u0430 \u043f\u043e\u043c\u0438\u043b\u043a\u0430. \u0411\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u0442\u0435 \u043d\u0430\u0432\u0435\u0434\u0435\u043d\u0456 \u043d\u0438\u0436\u0447\u0435 \u0434\u0430\u043d\u0456 \u0440\u043e\u0437\u0440\u043e\u0431\u043d\u0438\u043a\u0443.",appName:"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0456 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0438",
nameCol:"\u0406\u043c'\u044f",numberOfMessagesCol:"\u0423\u0441\u044c\u043e\u0433\u043e \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",kbytes:"\u0412\u0440\u0430\u0445\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0440\u043e\u0437\u043c\u0456\u0440 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",gettingNames:"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u0456\u043c\u0435\u043d \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0456\u0432",
symbolsCol:"\u0412\u0441\u044c\u043e\u0433\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",sentSymbolsCol:"\u0412\u0438 \u0432\u0456\u0434\u043f\u0440\u0430\u0432\u0438\u043b\u0438 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",receivedSymbolsCol:"\u0412\u0438 \u043e\u0442\u0440\u0438\u043c\u0430\u043b\u0438 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",sentCol:"\u0412\u0438 \u0432\u0456\u0434\u043f\u0440\u0430\u0432\u0438\u043b\u0438",receivedCol:"\u0412\u0438 \u043e\u0434\u0435\u0440\u0436\u0430\u043b\u0438",
lastMsgCol:"\u041e\u0441\u0442\u0430\u043d\u043d\u0454 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f",messagesProcessed:"\u041e\u043f\u0440\u0430\u0446\u044e\u0432\u0430\u043d\u043d\u044f \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",processingMessages:"\u041e\u0431\u0440\u043e\u0431\u043a\u0430 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",done:"\u041e\u0431\u0440\u043e\u0431\u043a\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",
incoming:"\u0432\u0445\u0456\u0434\u043d\u0456",outgoing:"\u0432\u0438\u0445\u0456\u0434\u043d\u0438\u0445",dayWithMostMessages:"\u041d\u0430\u0439\u0431\u0456\u043b\u044c\u0448\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c \u0431\u0443\u043b\u043e",timeWithMostMessages:"\u041d\u0430\u0439\u0431\u0456\u043b\u044c\u0448\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",thankYou:"\u0421\u043f\u0430\u0441\u0438\u0431\u0456, \u0449\u043e \u0434\u043e\u0447\u0435\u043a\u0430\u043b\u0438\u0441\u044f, \u0441\u043f\u043e\u0434\u0456\u0432\u0430\u0454\u043c\u043e\u0441\u044f, \u0432\u043e\u043d\u043e \u0442\u043e\u0433\u043e \u043a\u043e\u0448\u0442\u0443\u0432\u0430\u043b\u043e!",
exportByTime:"\u0415\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0437\u0430 \u0447\u0430\u0441\u043e\u043c",exportByMessages:"\u0415\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0437\u0430 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f\u043c",warning:"\u0423\u0432\u0430\u0433\u0430! \u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u043e\u0431\u0440\u043e\u0431\u0438\u0442\u0438 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",
friendsOnly:"\u0412\u0440\u0430\u0445\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0442\u0456\u043b\u044c\u043a\u0438 \u0434\u0440\u0443\u0437\u0456\u0432",withSelected:"\u0412\u0438\u0431\u0440\u0430\u043d\u0456",exportToNote:"\u0435\u043a\u0441\u043f\u043e\u0440\u0442\u0443\u0432\u0430\u0442\u0438 \u0432 \u0437\u0430\u043c\u0456\u0442\u043a\u0443",ourGroup:"\u041d\u0430\u0448\u0430 \u0433\u0440\u0443\u043f\u0430",noteSuccess:"\u0417\u0430\u043c\u0456\u0442\u043a\u0430 \u0443\u0441\u043f\u0456\u0448\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0430",
noteFailure:"\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0437\u0430\u043c\u0456\u0442\u043a\u0443. \u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u043f\u0456\u0437\u043d\u0456\u0448\u0435.",seeNote:"\u041f\u043e\u0434\u0438\u0432\u0438\u0442\u0438\u0441\u044f",plotKbytesGraph:"\u043f\u043e\u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0433\u0440\u0430\u0444\u0456\u043a \u0437\u0430 \u043a\u0456\u043b\u044c\u043a\u0456\u0441\u0442\u044e \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",
plotMessagesGraph:"\u043f\u043e\u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0433\u0440\u0430\u0444\u0456\u043a \u0437\u0430 \u043a\u0456\u043b\u044c\u043a\u0456\u0441\u0442\u044e \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",wantToPlotGraphs:"\u042f \u0437\u0430\u0445\u043e\u0447\u0443 \u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0433\u0430\u0440\u043d\u0456 \u0433\u0440\u0430\u0444\u0456\u043a\u0438",totalFirstName:"\u0417\u0430\u0433\u0430\u043b\u044c\u043d\u0430",
totalLastName:"\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430",sortByKBytes:"C\u043e\u0440\u0442\u0443\u0432\u0430\u0442\u0438 \u043f\u043e \u043a\u0456\u043b\u043e\u0431\u0430\u0439\u0442\u0430\u043c",hideAvatars:"\u041d\u0435 \u043f\u043e\u043a\u0430\u0437\u0443\u0432\u0430\u0442\u0438 \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0456\u0457"}},3:{name:"english",strings:{authorizing:"Authorizing",authorized:"Authorization complete",loadingMessageNumbers:"Getting message numbers",
fatal:"Fatal error. Please, send the info below to the developers",appName:"Private messages statistics",settingsText:"Set your desired parameters",startButton:"Start",verbose:"Verbose mode",kbytes:"Count message sizes as well",nameCol:"Name",numberOfMessagesCol:"Number of messages",gettingNames:"Loading user names",sentCol:"Sent",receivedCol:"Received",symbolsCol:"Total symbols",sentSymbolsCol:"Sent symbols",receivedSymbolsCol:"Received symbols",lastMsgCol:"Last Message",messagesProcessed:"Messages processed",
processingMessages:"Processing messages",done:"Processing complete",incoming:"incoming",outgoing:"outgoing",dayWithMostMessages:"Day with most messages",timeWithMostMessages:"Time with most messages",thankYou:"Thank you for your time, we hope it was worth it!",exportByTime:"Export time statistics",exportByMessages:"Export message statistics",warning:"Warning! Failed to process messages",friendsOnly:"Count only for friends",withSelected:"Selected",exportToNote:"export to note",ourGroup:"Our club",
noteSuccess:"Note created successfully",noteFailure:"Failed to create a note. Please try again later",seeNote:"See it",plotKbytesGraph:"plot symbol number graph",plotMessagesGraph:"plot message number graph",wantToPlotGraphs:"I'd like to plot fancy graphs",totalFirstName:"Overall",totalLastName:"stats",sortByKBytes:"Sort by kilobytes",hideAvatars:"Hide user photos"}}},fatal:function(a){ui.setHeader(user.lang.fatal);ui.clearContent();var b=ce("textarea",{cols:80,rows:20},{fontFamily:"Courier new"});
b.innerHTML=a;ui.appendContentElement(b);throw a;},log:function(a){var a=formatDate(new Date,!0)+": "+a,b=ge("loggerPane");if(b==void 0||b==null)ui.addLoggerPane(),b=ge("loggerPane");b.innerHTML+=a+"\n";b.scrollTop=b.scrollHeight}},user={lang:SYS.LANGUAGES[langConfig.id]==void 0?SYS.LANGUAGES[3].strings:SYS.LANGUAGES[langConfig.id].strings,verbose:!1,kbytes:!0,friendsOnly:!1,plotGraphs:!0,sortByKBytes:!1,hideAvatars:!0},ui={progress_bar_width:600,setTitle:function(a){document.title=a},setHeader:function(a){show("header");
ge("title").innerHTML=a;this.setTitle(a)},setContent:function(a){ge("content").innerHTML=a},clearContent:function(){this.setContent("")},addcss:function(a){var b=document.createElement("style");b.type="text/css";b.appendChild(document.createTextNode(a));document.getElementsByTagName("head")[0].appendChild(b)},appendContentElement:function(a){ge("content").appendChild(a)},ProgressBar:function(a,b,e,c){a>b&&(a=b);var j=(a*100/b).toFixed(2),a=a/b*e,c=(c||"%").replace("%",j+"%");return html='<div class="vkprogbar_container" style="width:'+
(e+4)+'px;">\t\t\t\t\t<div class="vkprogbar vkpbframe" style="width: '+a+'px;">\t\t\t\t\t\t<div class="vkprogbar vkprogbarfr" style="width: '+e+'px;">'+c+'</div>\t\t\t\t\t</div>\t\t\t\t\t<div  class="vkprogbar vkprogbarbgframe" style="width: '+e+'px;">\t\t\t\t\t\t<div class="vkprogbar vkprogbarbg" style="width: '+e+'px;">'+c+"</div>\t\t\t\t\t</div>\t\t\t\t</div>"},createProgressBar:function(a){ui.addcss('\t\t\t.vkprogbar_container{margin:0 auto;}\t\t\t/*\t\t\t.vkprogbar{height:30px;  text-align:center;line-height:30px;}\t\t\t.vkprogbarfr{ box-shadow: inset 0 10px 26px rgba(255, 255, 255, 0.5); background-color: #6d8fb3; color:#fff; text-shadow: 0px 1px 0px #45688e;   border-style: solid;  border-width: 1px;  border-color: #7e9cbc #5c82ab #5c82ab;}\t\t\t.vkpbframe{position:absolute; border:1px solid #36638e; overflow:hidden}\t\t\t.vkprogbarbgframe{ box-shadow: inset 0 10px 26px rgba(255, 255, 255, 0.5); background-color: #eee; border:1px solid #ccc;}\t\t\t.vkprogbarbg{text-shadow: 0px 1px 0px #fff; border:1px solid #eee;}\t\t\t*/\t\t\t.vkprogbar{height:19px;  text-align:center;line-height:17px; font-size:10px;}\t\t\t.vkprogbarfr{ background-image:url("/images/progress_grad.gif"); background-color: #6D8FB3; color:#FFF; text-shadow: 0px 1px 0px #45688E;   border-style: solid;  border-width: 1px;  border-color: #7E9CBC #5C82AB #5C82AB;}\t\t\t.vkpbframe{position:absolute; border:1px solid #36638e; overflow:hidden}\t\t\t.vkprogbarbgframe{ background-color: #EEE; border:1px solid #ccc;}\t\t\t.vkprogbarbg{text-shadow: 0px 1px 0px #FFF; border:1px solid #EEE; box-shadow: inset 0 10px 26px rgba(255, 255, 255, 0.5); }\t\t');
a=ce("div",{id:"progressbar",innerHTML:ui.ProgressBar(0,1,this.progress_bar_width,a||" ")},{padding:"10px"});this.clearContent();this.appendContentElement(a)},updateProgressBar:function(a,b,e,c){var j=a+e,i=b+c,d=100*j/i,a=user.lang.messagesProcessed+": "+user.lang.incoming+": "+a+"/"+b+"; "+user.lang.outgoing+": "+e+"/"+c;ge("progressbar").innerHTML=ui.ProgressBar(j,i,this.progress_bar_width,a);this.setTitle(Math.floor(d)+"% "+user.lang.processingMessages)},sortBy:function(a,b){b=="tot-size"&&a.sort(function(a,
b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inSize+b.outSize-(a.inSize+a.outSize)});b=="in-size"&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inSize-a.inSize});b=="out-size"&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.outSize-a.outSize});b=="tot"&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inM+b.outM-(a.inM+a.outM)});b=="in"&&a.sort(function(a,b){a=
statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inM-a.inM});b=="out"&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.outM-a.outM});b=="date"&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.lastMessageDate-a.lastMessageDate});return a},displayStats:function(a,b,e){cur.messCheckedNum=0;actionsShown=!1;this.clearContent();handlePageView({width:950});b=ce("div",{className:"mailbox"});b.innerHTML+='<div id="mail_top_msg" class="message" style="display:none;"> </div> ';
this.appendContentElement(b);user.verbose&&SYS.log("Processing complete, rendering results");var c=ce("div",{id:"mail_bar",className:"clear_fix bar bar clearFix actionBar",innerHTML:'<div id="vkstats_text"><span>'+user.lang.thankYou+"</span>"+(messageProcessor.failed>0?" "+user.lang.warning+": "+messageProcessor.failed:"")+'<div style="float:right"> &copy; <a href="'+SYS.LINK_TO_CLUB+'" target="_blank">vkontakte-stats</a>, 2010 &ndash; 2011</div></div>'}),j=ce("div",{id:"mail_bar_act",innerHTML:'<span class="fl_l" style="padding-top:4px;">'+
user.lang.withSelected+": </span>","class":"fl_l"},{display:"none",paddingTop:"5px"});j.innerHTML+='<span id="mail_summary" style="display:none;"></span>';j.innerHTML+='<div class="button_gray fl_l"><button onclick="statCounter.exportToNote();">'+user.lang.exportToNote+"</button></div>";user.plotGraphs&&(iHTML='<span id="plot_graphs_links">',iHTML+='<div class="button_gray fl_l" id="plot_msg_graph_link"><button onclick="ui.plotGraph(false);">'+user.lang.plotMessagesGraph+"</button></div>",user.kbytes&&
(iHTML+='<div class="button_gray fl_l" id="plot_kb_graph_link"><button onclick="ui.plotGraph(true);">'+user.lang.plotKbytesGraph+"</button></div>"),j.innerHTML+=iHTML+"</span>");c.appendChild(ce("div",{id:"graph"},{display:"none",width:"100%",height:"400px"}));c.appendChild(j);b.appendChild(c);j=ce("div",{id:"mail_rows"});c=ce("table",{cellspacing:"0",cellpadding:"0",id:"mail_rows_t"},{width:"100%"});j.appendChild(c);b.appendChild(j);tableHTML='<thead><th class="mail_check" onmouseover="mail.checkOver(this, 0)" onmouseout="mail.checkOut(this, 0)" onclick="myCheckChange(this, 0)"><div class=""></div><input type="hidden" id="post_check_0"></th><th style="text-align: center, width: 30px"> </th><th class="messagePicture"> </th><th class="messageFrom">'+
user.lang.nameCol+'</th><th onclick="javascript: ui.sort(\'tot\');" style="cursor: pointer">'+user.lang.numberOfMessagesCol+'</th><th onclick="javascript: ui.sort(\'out\');" style="cursor: pointer">'+user.lang.sentCol+'</th><th onclick="javascript: ui.sort(\'in\');" style="cursor: pointer">'+user.lang.receivedCol+"</th>";user.kbytes&&(tableHTML+='<th onclick="javascript: ui.sort(\'tot-size\');" style="cursor: pointer">'+user.lang.symbolsCol+'</th><th onclick="javascript: ui.sort(\'out-size\');" style="cursor: pointer">'+
user.lang.sentSymbolsCol+'</th><th onclick="javascript: ui.sort(\'in-size\');" style="cursor: pointer">'+user.lang.receivedSymbolsCol+"</th>");tableHTML+='<th onclick="javascript: ui.sort(\'date\');" style="cursor: pointer">'+user.lang.lastMsgCol+"</th></thead>";c.innerHTML=tableHTML;b=ce("tbody");c.appendChild(b);a=[statCounter.ALL_ID].concat(this.sortBy(getKeys(a),e));for(e=0;e<a.length;e++){var i=a[e];sdata=statCounter.getStatData(i);udata=statCounter.getUserData(i);var c=ce("tr",{id:"mess"+i}),
j=ce("td",{innerHTML:i==statCounter.ALL_ID?"":e},{textAlign:"center",width:"30px"}),d=ce("td",{innerHTML:'<div class=""></div><input type="hidden" id="post_check_'+i+'">',className:"mail_check"});d.setAttribute("onmouseover","mail.checkOver(this, '"+i+"')");d.setAttribute("onmouseout","mail.checkOut(this, '"+i+"')");d.setAttribute("onclick","myCheckChange(this, '"+i+"')");var f=ce("td",{innerHTML:i==statCounter.ALL_ID?"":!user.hideAvatars?'<a href="/id'+i+'" target="_blank"><img src="'+(udata.photo?
udata.photo:"/images/question_c.gif")+'" /></a>':"",className:"messagePicture"}),i=ce("td",{innerHTML:(i==statCounter.ALL_ID?"":'<a href="/id'+i+'" target="_blank">')+udata.first_name+" "+udata.last_name+(i==statCounter.ALL_ID?"":"</a>"),className:"messageFrom"}),g=ce("td",{innerHTML:sdata.inM+sdata.outM}),h=ce("td",{innerHTML:sdata.outM}),k=ce("td",{innerHTML:sdata.inM});if(user.kbytes)var l=ce("td",{innerHTML:sdata.inSize+sdata.outSize}),n=ce("td",{innerHTML:sdata.outSize}),o=ce("td",{innerHTML:sdata.inSize});
var m=ce("td",{innerHTML:'<a href="mail.php?act=show&id='+sdata.lastMessageId+'" target="_blank">'+formatDate(new Date(sdata.lastMessageDate*1E3))+"</a>"});c.appendChild(d);c.appendChild(j);c.appendChild(f);c.appendChild(i);c.appendChild(g);c.appendChild(h);c.appendChild(k);user.kbytes&&(c.appendChild(l),c.appendChild(n),c.appendChild(o));c.appendChild(m);b.appendChild(c)}},sort:function(a){this.displayStats(statCounter.statByUser,statCounter.userData,a)},requestSettings:function(){this.setHeader(user.lang.appName+
" "+SYS.VERSION);ui.clearContent();this.removeLoggerPane();var a=new MessageBox({title:user.lang.settingsText});a.addButton(user.lang.startButton,function(){a.hide();messageProcessor.start()});var b='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_verbose" /></div>';b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_kbytes" /></div>';b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_sort_kbytes" /></div>';b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_friends_only" /></div>';
b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_fancy_graphs" /></div>';b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_hide_avatars" /></div>';a.content(b).show();new Checkbox(ge("param_verbose"),{label:user.lang.verbose,checked:0,onChange:function(){user.verbose=!user.verbose}});new Checkbox(ge("param_kbytes"),{label:user.lang.kbytes,checked:1,onChange:function(){user.kbytes=!user.kbytes}});new Checkbox(ge("param_sort_kbytes"),{label:user.lang.sortByKBytes,
checked:0,onChange:function(){user.sortByKBytes=!user.sortByKBytes}});new Checkbox(ge("param_friends_only"),{label:user.lang.friendsOnly,checked:0,onChange:function(){user.friendsOnly=!user.friendsOnly}});new Checkbox(ge("param_fancy_graphs"),{label:user.lang.wantToPlotGraphs,checked:1,onChange:function(){user.plotGraphs=!user.plotGraphs}});new Checkbox(ge("param_hide_avatars"),{label:user.lang.hideAvatars,checked:1,onChange:function(){user.hideAvatars=!user.hideAvatars}})},addLoggerPane:function(){var a=
ce("textarea",{cols:80,rows:20,id:"loggerPane"},{fontFamily:"Courier new"});insertAfter(a,ge("content"))},removeLoggerPane:function(){var a=ge("loggerPane");a!=void 0&&a.parentNode.removeChild(a)},onNoteNotCreated:function(){ge("mail_top_msg").innerHTML="<div>"+user.lang.noteFailure+"</div>";show("mail_top_msg")},onNoteCreated:function(a){ge("mail_top_msg").innerHTML="<div>"+user.lang.noteSuccess+'. <a href="/note'+user.uid+"_"+a+'" target="_blank">'+user.lang.seeNote+"</a></div>";show("mail_top_msg")},
sentColors:[6806590,15976256,15747131],receivedColors:[8374630,15584101,15754329],plotGraph:function(a){ge("graph").style.display="";var b={isRTL:window.is_rtl,"lang.select_graphs":fixQuot("filter"),"lang.months":fixQuot("January,February,March,April,May,June,July,August,September,October,November,December"),"lang.dayMonths":fixQuot("January,February,March,April,May,June,July,August,September,October,November,December"),"lang.dateFormats.day_fullmon_year_hour":fixQuot("{day} {dayMonth} {year}, {hour12}:00"),
"lang.dateFormats.day_fullmon_year":fixQuot("{month} {day}, {year}"),"lang.dateFormats.day_mon":fixQuot("{day} {month}"),"lang.dateFormats.day_fullmon":fixQuot("{day} {month}"),"lang.loading":fixQuot("Loading..."),"lang.no_data":fixQuot("No input data"),"lang.data_empty":fixQuot("Input data is empty"),"lang.error_loading":fixQuot("Loading error")};flashVars=clone(b);for(var b=ge("mail_rows_t"),e="[",c=0,j=0;j<b.rows.length;++j){var i=b.rows[j];if((i=i.id?intval(i.id.replace(/^mess/,"")):0)&&cur.messChecked[i]){c>
0&&(e+=",");if(a)var d=0,f=0,g='{"c": '+this.receivedColors[c]+',"f": 0, "d": [',h='{"c": '+this.sentColors[c]+',"f": 0, "d": [';else var k=0,l=0,n='{"c": '+this.sentColors[c]+',"f": 0, "d": [',o='{"c": '+this.receivedColors[c]+',"f": 0, "d": [';for(var m in statCounter.getStatData(i).history){var p=statCounter.getStatData(i).history[m];a?(d+=p.outSize,f+=p.inSize,h+="["+m+","+d+"],",g+="["+m+","+f+"],"):(k+=p.outM,l+=p.inM,n+="["+m+","+k+"],",o+="["+m+","+l+"],")}a?(h+="["+statCounter.lastMessageTime+
","+d+']], "name": "'+statCounter.getUserData(i).first_name+" "+statCounter.getUserData(i).last_name+": "+user.lang.sentCol+'"}',g+="["+statCounter.lastMessageTime+","+f+']], "name": "'+statCounter.getUserData(i).first_name+" "+statCounter.getUserData(i).last_name+": "+user.lang.receivedCol+'"}',e+=h+","+g):(n+="["+statCounter.lastMessageTime+","+k+']], "name": "'+statCounter.getUserData(i).first_name+" "+statCounter.getUserData(i).last_name+": "+user.lang.sentCol+'"}',o+="["+statCounter.lastMessageTime+
","+l+']], "name": "'+statCounter.getUserData(i).first_name+" "+statCounter.getUserData(i).last_name+": "+user.lang.receivedCol+'"}',e+=n+","+o);c++}}flashVars.graphdata=fixQuot(e+"]");user.verbose&&SYS.log("plotting: "+flashVars.graphdata);flashVars.div_id="graph";renderFlash("graph",{url:"/swf/graph.swf?0.28",id:"graph",width:"100%",height:400,version:8},{allowfullscreen:"true"},flashVars)}},statCounter={statByUser:{},userData:{},lastMessageTime:0,overallStats:{inM:0,outM:0,lastMessageDate:0,lastMessageId:0,
inSize:0,outSize:0,history:{}},ALL_ID:-1,createEmptyStatsFor:function(a){var b={inM:0,outM:0,lastMessageDate:a.date,lastMessageId:a.mid,inSize:0,outSize:0,history:{}};return this.statByUser[a.uid]=b},updateStats:function(a,b){if(b.lastMessageDate<a.date)b.lastMessageDate=a.date,b.lastMessageId=a.mid;if(statCounter.lastMessageTime<a.date)statCounter.lastMessageTime=a.date;a.out?(b.outM++,b.outSize+=a.body.length):(b.inM++,b.inSize+=a.body.length);user.plotGraphs&&(b.history[a.date]={inM:a.out?0:1,
outM:a.out?1:0,inSize:a.out?0:a.body.length,outSize:a.out?a.body.length:0})},processSingleMessage:function(a){userStats=this.statByUser[a.uid];userStats==void 0&&(userStats=this.createEmptyStatsFor(a));this.updateStats(a,userStats);this.updateStats(a,this.overallStats)},getStatData:function(a){if(a==this.ALL_ID)return this.overallStats;return this.statByUser[a]},getUserData:function(a){if(a==this.ALL_ID)return{first_name:user.lang.totalFirstName,last_name:user.lang.totalLastName};return this.userData[a]==
void 0?{first_name:"DELETED",last_name:"DELETED"}:this.userData[a]},generateNoteContents:function(){var a="[[club21792535|vkontakte-stats]]\n\n";a+="{|\n";a+="|-\n";a+="! ";a+="!! "+user.lang.nameCol;a+="!! "+user.lang.numberOfMessagesCol;a+="!! "+user.lang.sentCol;a+="!! "+user.lang.receivedCol;user.kbytes&&(a+="!! "+user.lang.symbolsCol,a+="!! "+user.lang.sentSymbolsCol,a+="!! "+user.lang.receivedSymbolsCol);a+="\n";for(var b=0,e=ge("mail_rows_t"),c=0;c<e.rows.length;++c){var j=e.rows[c],j=j.id?
j.id.replace(/^mess/,""):0;j!=0&&(j!=this.ALL_ID&&b++,cur.messChecked[j]&&(sdata=this.getStatData(j),udata=this.getUserData(j),a+="|-\n",a+="| "+(j!=this.ALL_ID?b:"")+"\n",a+="| [[id"+j+"|"+udata.first_name+" "+udata.last_name+"]]\n",a+="| "+(sdata.inM+sdata.outM)+"\n",a+="| "+sdata.outM+"\n",a+="| "+sdata.inM+"\n",user.kbytes&&(a+="| "+(sdata.inSize+sdata.outSize)+"\n",a+="| "+sdata.outSize+"\n",a+="| "+sdata.inSize+"\n")))}a+="|}\n";return a},exportToNote:function(){apiConnector.createNote(user.lang.appName,
this.generateNoteContents(),function(a,b){var e=eval("("+b+")");e.response==void 0?(SYS.log("Note creationg failed!"+b),ui.onNoteNotCreated()):(e=e.response.nid,user.verbose&&SYS.log("Note created: "+e),ui.onNoteCreated(e))})}},messageProcessor={incomingMessages:void 0,processedIncomingMessages:0,outgoingMessages:void 0,processedOutgoingMessages:0,failed:0,onUserProfilesLoaded:function(a){a.response==void 0&&SYS.fatal(response);for(var a=a.response,b=0;b<a.length;b++)statCounter.userData[a[b].uid]=
a[b];ui.setHeader(user.lang.done+"!");ui.displayStats(statCounter.statByUser,statCounter.userData,user.kbytes&&user.sortByKBytes?"tot-size":"tot")},onAllMessagesLoaded:function(){ui.updateProgressBar(this.processedIncomingMessages,this.incomingMessages,this.processedOutgoingMessages,this.outgoingMessages);ui.setHeader(user.lang.gettingNames+"...");user.verbose&&SYS.log("Got all messages, getting user names");this.api.getUserNames(getKeys(statCounter.statByUser),messageProcessor.onUserProfilesLoaded)},
onMessagesLoaded:function(a,b){var e=0;if(a==void 0)this.failed+=SYS.MESSAGES_PER_REQUEST,SYS.log("Skipping "+SYS.MESSAGES_PER_REQUEST+" messages..."),b?this.processedOutgoingMessages+=SYS.MESSAGES_PER_REQUEST:this.processedIncomingMessages+=SYS.MESSAGES_PER_REQUEST,e=this.offset+SYS.MESSAGES_PER_REQUEST;else if(a.response!=void 0){var e=a.response,c=e[0];user.verbose&&SYS.log("Got "+(e.length-1)+" messages");for(var j=1;j<e.length;j++)statCounter.processSingleMessage(e[j]);if(b){if(this.processedOutgoingMessages+=
e.length-1,e=this.processedOutgoingMessages+(c-this.outgoingMessages),c!=this.outgoingMessages&&user.verbose&&SYS.log("By the way, the user has sent "+(c-this.outgoingMessages)+" message(s) after the script was started"),e>=c||SYS.DEBUG&&e>=SYS.MESSAGES_TO_PROCESS_IN_DEBUG_MODE){this.onAllMessagesLoaded();return}}else if(this.processedIncomingMessages+=e.length-1,e=this.processedIncomingMessages+(c-this.incomingMessages),c!=this.incomingMessages&&user.verbose&&SYS.log("By the way, the user has received "+
(c-this.incomingMessages)+" message(s) after the script was started"),e>=c||SYS.DEBUG&&e>=SYS.MESSAGES_TO_PROCESS_IN_DEBUG_MODE)b=1,e=0;ui.updateProgressBar(this.processedIncomingMessages,this.incomingMessages,this.processedOutgoingMessages,this.outgoingMessages)}else b=this.out,e=this.offset;c=(new Date).getTime()-this.requestStartTime;user.verbose&&SYS.log("Elapsed time:  "+c+" ms");c>=SYS.MSEC_BETWEEN_REQUESTS?(user.verbose&&SYS.log("Starting new request..."),this.requestStartTime=(new Date).getTime(),
this.api.getMessages(b,e,SYS.MESSAGES_PER_REQUEST,function(a){messageProcessor.onMessagesLoaded(a,b)})):(this.out=b,this.offset=e,user.verbose&&SYS.log("Scheduling new request in "+(SYS.MSEC_BETWEEN_REQUESTS-c)+"ms"),setTimeout("messageProcessor.requestStartTime = (new Date()).getTime(); messageProcessor.api.getMessages(messageProcessor.out, messageProcessor.offset, SYS.MESSAGES_PER_REQUEST, function(response) {messageProcessor.onMessagesLoaded(response, messageProcessor.out)});",SYS.MSEC_BETWEEN_REQUESTS-
c))},startProcessingMessages:function(){ui.setHeader(user.lang.processingMessages+"...");ui.createProgressBar(user.lang.processingMessages+"...");ui.updateProgressBar(0,this.incomingMessages,0,this.outgoingMessages);this.requestStartTime=(new Date).getTime();this.api.getMessages(0,0,SYS.MESSAGES_PER_REQUEST,function(a){messageProcessor.onMessagesLoaded(a,0)})},onMessageNumbersLoaded:function(a,b){var e=a.response;user.verbose&&SYS.log("Loaded message numbers ["+b+"]: "+e[0]);b?this.outgoingMessages=
e[0]:this.incomingMessages=e[0];this.incomingMessages!=void 0&&this.outgoingMessages!=void 0&&setTimeout(function(){messageProcessor.startProcessingMessages()},SYS.MSEC_BETWEEN_REQUESTS)},getNumberOfMessages:function(){this.api.getMessages(0,0,1,function(a){messageProcessor.onMessageNumbersLoaded(a,0)});setTimeout(function(){apiConnector.getMessages(1,0,1,function(a){messageProcessor.onMessageNumbersLoaded(a,1)})},SYS.MSEC_BETWEEN_REQUESTS*2)},start:function(){this.api=apiConnector;user.verbose&&
(ui.addLoggerPane(),SYS.log("Started"));ui.setHeader(user.lang.loadingMessageNumbers);this.getNumberOfMessages()}},vk_api={API_ID:SYS.APP_ID,SETTINGS:SYS.LOGIN_SETTING,NOT_USED_SETTING:32768,allow_call:!0,auth_frame:null,log:function(){},Auth:function(a){var b=vk_api.API_ID,e=vk_api.SETTINGS,c=function(){if(vk_api.auth_frame)setTimeout(function(){vk_api.Auth(a)},2E3);else{vk_api.auth_frame=ce("iframe",{src:"/login.php?app="+b+"&layout=popup&type=browser&settings="+e},{position:"relative",width:"530px",
height:"400px",border:"0px"});vk_api.auth_frame.onload=function(){vk_api.onAuth(a)};vk_api.aBox=new MessageBox({title:0,width:"560px",onHide:function(){var a=vk_api.auth_frame;vk_api.auth_frame=null;re(a)}});var c=vk_api.aBox;c.removeButtons();c.addButton(getLang("box_close"),c.hide);c.content('<div id="vk_api_auth"></div>');c.show();ge("vk_api_auth").appendChild(vk_api.auth_frame)}};vk_api.ajax("/login.php?app="+vk_api.API_ID+"&layout=popup&type=browser&settings="+vk_api.SETTINGS,{},function(b,e){if(e.indexOf("Login success")!=
-1)vk_api.onAuth(a);else c()})},onAuth:function(a){var b=function(b,c){var j="{"+c.split("app_session = {")[1].split("}")[0]+"}";sessionInfo=eval("("+j+")");vk_api.mid=sessionInfo.mid;vk_api.secret=sessionInfo.secret;vk_api.sid=sessionInfo.sid;a&&a(vk_api.mid,vk_api.secret,vk_api.sid)};vk_api.ajax("/login.php?app="+vk_api.API_ID+"&layout=popup&type=browser&settings="+vk_api.SETTINGS,{},function(a,c){if(c.indexOf("Login failure")!=-1)SYS.fatal("failed to log on. ");else if(c.indexOf("Login success")!=
-1){if(vk_api.aBox)vk_api.aBox.hide(),vk_api.aBox=null;vk_api.ajax("/login.php?app="+vk_api.API_ID+"&layout=popup&type=browser&settings="+vk_api.NOT_USED_SETTING,{},b)}})},show_error:function(a){topError(a.error.error_msg+"<br>error_code: "+a.error.error_code,{dt:2})},call:function(a,b,e,c){arguments.length==2&&(e=b,b={});vk_api.allow_call?(vk_api.allow_call=!1,vk_api.allow_t=setTimeout("vk_api.allow_call=true;",300)):setTimeout(function(){vk_api.call(a,b,e)},300);var j=function(){vk_api.Auth(function(){vk_api.call(a,
b,e)})},i=vk_api.mid,d=vk_api.sid,f=vk_api.secret;if(!vk_api.sid||!vk_api.secret||!vk_api.mid||vk_api.mid!=vk.id)j();else{var g={api_id:vk_api.API_ID,method:a,v:"3.0",format:"json"};if(b)for(var h in b)g[h]=b[h];var k=[];for(h in g)k.push([h,g[h]]);k.sort(function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0});var l=i;for(h in k)l+=k[h][0]+"="+k[h][1];l+=f;(function(){g.sig=md5(l);g.sid=d;vk_api.log("api.call("+a+(window.JSON?", "+JSON.stringify(b):"")+")");vk_api.ajax("/api.php",g,function(d,g){g==""&&
(g="{}");var f=eval("("+g+")");f.error?f.error.error_code==6?setTimeout(function(){vk_api.call(a,b,e)},500):f.error.error_code==4||f.error.error_code==3||f.error.error_code==7?j():f.error.error_code==14?vk_api.captcha(f.error.captcha_sid,f.error.captcha_img,function(c,d){b.captcha_sid=c;b.captcha_key=d;vk_api.call(a,b,e,!0)},!1,function(){e(f)}):(vk_api.show_error(f),c&&vk_api_captchaBox.hide(),e(f,f.response,f.error)):(c&&vk_api_captchaBox.hide(),e(f))})})()}},captcha:function(a,b,e,c,j){var i=vk_api_captchaBox=
new MessageBox({title:getLang("captcha_enter_code"),width:300});i.removeButtons();var d,f=f||"/",g=function(){removeEvent(d,"keypress");e(a,d.value);hide("captchaKey");show("captchaLoader")};i.addButton(getLang("captcha_cancel"),function(){removeEvent(d,"keypress");i.hide()},"no");i.addButton(getLang("captcha_send"),g);i.setOptions({onHide:j,bodyStyle:"padding: 16px 14px"});i.content('<div style="text-align: center; height: 76px"><a href="#" id="refreshCaptcha"><img id="captchaImg" class="captchaImg" src="'+
b+'"/></a><div></div><input id="captchaKey" class="inputText" name="captcha_key" type="text" style="width: 120px; margin: 3px 0px 0px;" maxlength="7"/><img id="captchaLoader" src="'+f+'images/progress7.gif" style="display:none; margin-top: 13px;" /></div>');i.show();isFunction(c)&&c();d=ge("captchaKey");addEvent(d,"keypress",function(a){a.keyCode==13&&g()});addEvent(ge("refreshCaptcha"),"click",g);d.focus()},ajax:function(a,b,e){var c=null;try{c=new XMLHttpRequest}catch(j){c=null}try{c||(c=new ActiveXObject("Msxml2.XMLHTTP"))}catch(i){c=
null}try{c||(c=new ActiveXObject("Microsoft.XMLHTTP"))}catch(d){c=null}if(!c)return!1;c.onreadystatechange=function(){c.readyState==4&&e&&e(c,c.responseText)};c.open("POST",a,!0);c.setRequestHeader&&(c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.setRequestHeader("X-Requested-With","XMLHttpRequest"));c.send(function(a){var b=[];if(a instanceof Object){for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}else return encodeURIComponent(a)}(b));
return!0}};
apiConnector={getMessages_:function(a,b,e,c){user.verbose&&SYS.log("getMessages invoked: out="+a+"; offset="+b);vk_api.call("messages.get",{filters:user.friendsOnly?4:0,offset:b,out:a,preview_length:user.kbytes?0:1,count:e},c)},getMessages:function(a,b,e,c){user.verbose&&SYS.log("getMessages invoked: out="+a+"; offset="+b);var j=e,i=user.kbytes?0:1,d=user.friendsOnly?4:0;code_body="";code_r=[];steps=Math.ceil(e/100);for(var f=0;f<steps;f++)code_body+="var x"+f+"=API.messages.get("+to_json({count:e>100?
100:e,offset:b,filters:d,out:a,preview_length:i})+");\n",code_r.push("x"+f),e-=100,b+=100;code_body+="\nreturn ["+code_r.join(",")+"];";vk_api.call("execute",{code:code_body},function(a){for(var b=null,a=a.response,d=0;d<a.length;d++)if(b){if(a[d]&&a[d].length>0){var e=a[d];e.shift();for(var f=0;f<e.length;f++)b.push(e[f])}}else b=a[d];user.verbose&&(a=j-b.length+1,a>0&&SYS.log("Lost Messages count:"+a));c({response:b})})},doGetUserData:function(a,b){user.verbose&&SYS.log("doGetUserData invoked: ids="+
a);vk_api.call("getProfiles",{uids:a.join(","),fields:"photo"},b)},getUserNames:function(a,b,e){var a=splitArrayToSubArrays(a,SYS.MAX_USERS_PER_REQUEST),c=null,j=0,i=function(d){if(d&&d.response)if(c)for(var f=0;f<d.response.length;f++)c.response.push(d.response[f]);else c=d;a[j]?setTimeout(function(){e&&e(j);apiConnector.doGetUserData(a[j],i);j++},SYS.MSEC_BETWEEN_REQUESTS):b(c)};i()},createNote:function(a,b,e){user.verbose&&SYS.log("createNote:  title="+a+"; text="+b);vk_api.call("notes.add",{text:b,
title:a},e)}};SYS.VERSION="4.3";window.renderFlash?stManager.add(SYS.FILES_TO_LOAD,function(){vk_api.Auth(function(a){user.uid=a;ui.requestSettings()})}):alert(user.lang.wrongPage);
