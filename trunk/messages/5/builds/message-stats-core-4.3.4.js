var getKeys=function(a){var b=[],e;for(e in a)b.push(e);return b},fixQuot=function(a){return browser.msie?a.replace(/\"/g,"&quot;"):a},nKeys=function(a){var b=0,e;for(e in a)b++;return b},splitArrayToSubArrays=function(a,b){for(var e=[],d=0;d<a.length/b;d++)e.push(a.slice(b*d,b*(d+1)));return e},formatDate=function(a,b){var e=a.getFullYear(),d=a.getMonth()+1;10>d&&(d="0"+d);var j=a.getDate();10>j&&(j="0"+j);var i=a.getHours();10>i&&(i="0"+i);var c=a.getMinutes();10>c&&(c="0"+c);var f=a.getSeconds();
10>f&&(f="0"+f);if(b){var h=mod(a.getTime(),1E3);100>h&&(h="0"+h);10>intval(h)&&(h="0"+h);f=f+"."+h}return e+"-"+d+"-"+j+" "+i+":"+c+":"+f},insertAfter=function(a,b){var e=b.nextSibling;e?e.parentNode.insertBefore(a,e):b.parentNode.appendChild(a)},mod=function(a,b){return a%b},to_json=function(a){var b=typeof a;if("object"!=b||null===a)return"string"==b&&(a='"'+a+'"'),String(a);var e,d,j=[],i=a&&a.constructor==Array;for(e in a)d=a[e],b=typeof d,"string"==b?d='"'+d+'"':"object"==b&&null!==d&&(d=JSON.stringify(d)),
j.push((i?"":'"'+e+'":')+String(d));return(i?"[":"{")+String(j)+(i?"]":"}")},myCheckChange=function(a,b){cur.messChecked||(cur.messChecked={});null==cur.messCheckedNum&&(cur.messCheckedNum=0);mail.checkChange(a,b);(0<cur.messCheckedNum?hide:show)("vkstats_text");cur.messCheckedNum>SYS.MAX_USERS_AT_ONE_GRAPH?user.plotGraphs&&hide("plot_graphs_links"):user.plotGraphs&&show("plot_graphs_links")},rotateLeft=function(a,b){return a<<b|a>>>32-b},addUnsigned=function(a,b){var e,d,j,i,c;j=a&2147483648;i=b&
2147483648;e=a&1073741824;d=b&1073741824;c=(a&1073741823)+(b&1073741823);return e&d?c^2147483648^j^i:e|d?c&1073741824?c^3221225472^j^i:c^1073741824^j^i:c^j^i},F=function(a,b,e){return a&b|~a&e},G=function(a,b,e){return a&e|b&~e},H=function(a,b,e){return a^b^e},I=function(a,b,e){return b^(a|~e)},FF=function(a,b,e,d,j,i,c){a=addUnsigned(a,addUnsigned(addUnsigned(F(b,e,d),j),c));return addUnsigned(rotateLeft(a,i),b)},GG=function(a,b,e,d,j,i,c){a=addUnsigned(a,addUnsigned(addUnsigned(G(b,e,d),j),c));
return addUnsigned(rotateLeft(a,i),b)},HH=function(a,b,e,d,j,i,c){a=addUnsigned(a,addUnsigned(addUnsigned(H(b,e,d),j),c));return addUnsigned(rotateLeft(a,i),b)},II=function(a,b,e,d,j,i,c){a=addUnsigned(a,addUnsigned(addUnsigned(I(b,e,d),j),c));return addUnsigned(rotateLeft(a,i),b)},convertToWordArray=function(a){var b,e=a.length;b=e+8;for(var d=16*((b-mod(b,64))/64+1),j=Array(d-1),i=0,c=0;c<e;)b=(c-mod(c,4))/4,i=8*mod(c,4),j[b]|=a.charCodeAt(c)<<i,c++;b=(c-mod(c,4))/4;i=8*mod(c,4);j[b]|=128<<i;j[d-
2]=e<<3;j[d-1]=e>>>29;return j},wordToHex=function(a){var b="",e="",d;for(d=0;3>=d;d++)e=a>>>8*d&255,e="0"+e.toString(16),b+=e.substr(e.length-2,2);return b},uTF8Encode=function(a){for(var a=a.replace(/\x0d\x0a/g,"\n"),b="",e=0;e<a.length;e++){var d=a.charCodeAt(e);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b},md5=function(a){var b=[],e,d,j,i,c,f,h,
g,a=uTF8Encode(a),b=convertToWordArray(a);c=1732584193;f=4023233417;h=2562383102;g=271733878;for(a=0;a<b.length;a+=16)e=c,d=f,j=h,i=g,c=FF(c,f,h,g,b[a+0],7,3614090360),g=FF(g,c,f,h,b[a+1],12,3905402710),h=FF(h,g,c,f,b[a+2],17,606105819),f=FF(f,h,g,c,b[a+3],22,3250441966),c=FF(c,f,h,g,b[a+4],7,4118548399),g=FF(g,c,f,h,b[a+5],12,1200080426),h=FF(h,g,c,f,b[a+6],17,2821735955),f=FF(f,h,g,c,b[a+7],22,4249261313),c=FF(c,f,h,g,b[a+8],7,1770035416),g=FF(g,c,f,h,b[a+9],12,2336552879),h=FF(h,g,c,f,b[a+10],
17,4294925233),f=FF(f,h,g,c,b[a+11],22,2304563134),c=FF(c,f,h,g,b[a+12],7,1804603682),g=FF(g,c,f,h,b[a+13],12,4254626195),h=FF(h,g,c,f,b[a+14],17,2792965006),f=FF(f,h,g,c,b[a+15],22,1236535329),c=GG(c,f,h,g,b[a+1],5,4129170786),g=GG(g,c,f,h,b[a+6],9,3225465664),h=GG(h,g,c,f,b[a+11],14,643717713),f=GG(f,h,g,c,b[a+0],20,3921069994),c=GG(c,f,h,g,b[a+5],5,3593408605),g=GG(g,c,f,h,b[a+10],9,38016083),h=GG(h,g,c,f,b[a+15],14,3634488961),f=GG(f,h,g,c,b[a+4],20,3889429448),c=GG(c,f,h,g,b[a+9],5,568446438),
g=GG(g,c,f,h,b[a+14],9,3275163606),h=GG(h,g,c,f,b[a+3],14,4107603335),f=GG(f,h,g,c,b[a+8],20,1163531501),c=GG(c,f,h,g,b[a+13],5,2850285829),g=GG(g,c,f,h,b[a+2],9,4243563512),h=GG(h,g,c,f,b[a+7],14,1735328473),f=GG(f,h,g,c,b[a+12],20,2368359562),c=HH(c,f,h,g,b[a+5],4,4294588738),g=HH(g,c,f,h,b[a+8],11,2272392833),h=HH(h,g,c,f,b[a+11],16,1839030562),f=HH(f,h,g,c,b[a+14],23,4259657740),c=HH(c,f,h,g,b[a+1],4,2763975236),g=HH(g,c,f,h,b[a+4],11,1272893353),h=HH(h,g,c,f,b[a+7],16,4139469664),f=HH(f,h,g,
c,b[a+10],23,3200236656),c=HH(c,f,h,g,b[a+13],4,681279174),g=HH(g,c,f,h,b[a+0],11,3936430074),h=HH(h,g,c,f,b[a+3],16,3572445317),f=HH(f,h,g,c,b[a+6],23,76029189),c=HH(c,f,h,g,b[a+9],4,3654602809),g=HH(g,c,f,h,b[a+12],11,3873151461),h=HH(h,g,c,f,b[a+15],16,530742520),f=HH(f,h,g,c,b[a+2],23,3299628645),c=II(c,f,h,g,b[a+0],6,4096336452),g=II(g,c,f,h,b[a+7],10,1126891415),h=II(h,g,c,f,b[a+14],15,2878612391),f=II(f,h,g,c,b[a+5],21,4237533241),c=II(c,f,h,g,b[a+12],6,1700485571),g=II(g,c,f,h,b[a+3],10,2399980690),
h=II(h,g,c,f,b[a+10],15,4293915773),f=II(f,h,g,c,b[a+1],21,2240044497),c=II(c,f,h,g,b[a+8],6,1873313359),g=II(g,c,f,h,b[a+15],10,4264355552),h=II(h,g,c,f,b[a+6],15,2734768916),f=II(f,h,g,c,b[a+13],21,1309151649),c=II(c,f,h,g,b[a+4],6,4149444226),g=II(g,c,f,h,b[a+11],10,3174756917),h=II(h,g,c,f,b[a+2],15,718787259),f=II(f,h,g,c,b[a+9],21,3951481745),c=addUnsigned(c,e),f=addUnsigned(f,d),h=addUnsigned(h,j),g=addUnsigned(g,i);return(wordToHex(c)+wordToHex(f)+wordToHex(h)+wordToHex(g)).toLowerCase()},
SYS={VERSION:"4.2.1",APP_ID:2045168,LOGIN_SETTING:6144,DEBUG:!1,MESSAGES_TO_PROCESS_IN_DEBUG_MODE:400,MESSAGES_PER_REQUEST:1E3,MSEC_BETWEEN_REQUESTS:333,MSEC_BETWEEN_REQUESTS_FOR_USERDATA:1E3,MAX_USERS_PER_REQUEST:1E3,LINK_TO_CLUB:"/club21792535",TOO_MANY_REQUESTS_ERR_CODE:6,MAX_USERS_AT_ONE_GRAPH:3,FILES_TO_LOAD:["mail.css","mail.js","ui_controls.js","ui_controls.css","common.js"],LANGUAGES:{"0":{name:"russian",strings:{authorizing:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f",
authorized:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",loadingMessageNumbers:"\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0447\u0438\u0441\u043b\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",fatal:"\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0441\u043e\u043e\u0431\u0449\u0438\u0442\u0435 \u043f\u0440\u0438\u0432\u0435\u0434\u0451\u043d\u043d\u044b\u0435 \u043d\u0438\u0436\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443.",
appName:"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0438\u0447\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0438",nameCol:"\u0418\u043c\u044f",kbytes:"\u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",settingsText:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0436\u0435\u043b\u0430\u0435\u043c\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b",
startButton:"\u041f\u043e\u0435\u0445\u0430\u043b\u0438!",verbose:"\u041b\u043e\u0433\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f",gettingNames:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u043c\u0451\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439",numberOfMessagesCol:"\u0412\u0441\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",sentCol:"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e",
receivedCol:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e",symbolsCol:"\u0412\u0441\u0435\u0433\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",sentSymbolsCol:"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",receivedSymbolsCol:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",lastMsgCol:"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",
processingMessages:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",done:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",messagesProcessed:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",incoming:"\u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445",outgoing:"\u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0445",
dayWithMostMessages:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0432\u0441\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0431\u044b\u043b\u043e",timeWithMostMessages:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0432\u0441\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",thankYou:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e, \u0447\u0442\u043e \u0434\u043e\u0436\u0434\u0430\u043b\u0438\u0441\u044c, \u043d\u0430\u0434\u0435\u0435\u043c\u0441\u044f, \u043e\u043d\u043e \u0442\u043e\u0433\u043e \u0441\u0442\u043e\u0438\u043b\u043e!",
exportByTime:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u043f\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438",exportByMessages:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u043f\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u043c",warning:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",
friendsOnly:"\u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u0440\u0443\u0437\u0435\u0439",withSelected:"\u0412\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0435",exportToNote:"\u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0437\u0430\u043c\u0435\u0442\u043a\u0443",ourGroup:"\u041d\u0430\u0448\u0430 \u0433\u0440\u0443\u043f\u043f\u0430",noteSuccess:"\u0417\u0430\u043c\u0435\u0442\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0430",
noteFailure:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u043c\u0435\u0442\u043a\u0443. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437 \u043f\u043e\u0437\u0434\u043d\u0435\u0435.",seeNote:"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c",plotKbytesGraph:"\u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a \u043f\u043e \u0447\u0438\u0441\u043b\u0443 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",
plotMessagesGraph:"\u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a \u043f\u043e \u0447\u0438\u0441\u043b\u0443 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",wantToPlotGraphs:"\u042f \u0437\u0430\u0445\u043e\u0447\u0443 \u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a\u0438 \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043e\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438",totalFirstName:"\u041e\u0431\u0449\u0430\u044f",
totalLastName:"\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430",sortByKBytes:"\u0421\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u043a\u0438\u043b\u043e\u0431\u0430\u0439\u0442\u0430\u043c",hideAvatars:"\u041d\u0435 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439"}},1:{name:"ukrainian",strings:{authorizing:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u044f",
authorized:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",loadingMessageNumbers:"\u0412\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u044f \u043a\u0456\u043b\u044c\u043a\u043e\u0441\u0442\u0456 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",settingsText:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u0431\u0430\u0436\u0430\u043d\u0456 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0438",startButton:"\u041f\u043e\u0457\u0445\u0430\u043b\u0438!",
verbose:"\u041b\u043e\u0433\u0443\u0432\u0430\u0442\u0438 \u0432\u0441\u0456 \u0434\u0456\u0457",fatal:"\u041a\u0440\u0438\u0442\u0438\u0447\u043d\u0430 \u043f\u043e\u043c\u0438\u043b\u043a\u0430. \u0411\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u0442\u0435 \u043d\u0430\u0432\u0435\u0434\u0435\u043d\u0456 \u043d\u0438\u0436\u0447\u0435 \u0434\u0430\u043d\u0456 \u0440\u043e\u0437\u0440\u043e\u0431\u043d\u0438\u043a\u0443.",appName:"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0456 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0438",
nameCol:"\u0406\u043c'\u044f",numberOfMessagesCol:"\u0423\u0441\u044c\u043e\u0433\u043e \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",kbytes:"\u0412\u0440\u0430\u0445\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0440\u043e\u0437\u043c\u0456\u0440 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",gettingNames:"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u0456\u043c\u0435\u043d \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0456\u0432",
symbolsCol:"\u0412\u0441\u044c\u043e\u0433\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",sentSymbolsCol:"\u0412\u0438 \u0432\u0456\u0434\u043f\u0440\u0430\u0432\u0438\u043b\u0438 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",receivedSymbolsCol:"\u0412\u0438 \u043e\u0442\u0440\u0438\u043c\u0430\u043b\u0438 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",sentCol:"\u0412\u0438 \u0432\u0456\u0434\u043f\u0440\u0430\u0432\u0438\u043b\u0438",receivedCol:"\u0412\u0438 \u043e\u0434\u0435\u0440\u0436\u0430\u043b\u0438",
lastMsgCol:"\u041e\u0441\u0442\u0430\u043d\u043d\u0454 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f",messagesProcessed:"\u041e\u043f\u0440\u0430\u0446\u044e\u0432\u0430\u043d\u043d\u044f \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",processingMessages:"\u041e\u0431\u0440\u043e\u0431\u043a\u0430 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",done:"\u041e\u0431\u0440\u043e\u0431\u043a\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",
incoming:"\u0432\u0445\u0456\u0434\u043d\u0456",outgoing:"\u0432\u0438\u0445\u0456\u0434\u043d\u0438\u0445",dayWithMostMessages:"\u041d\u0430\u0439\u0431\u0456\u043b\u044c\u0448\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c \u0431\u0443\u043b\u043e",timeWithMostMessages:"\u041d\u0430\u0439\u0431\u0456\u043b\u044c\u0448\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",thankYou:"\u0421\u043f\u0430\u0441\u0438\u0431\u0456, \u0449\u043e \u0434\u043e\u0447\u0435\u043a\u0430\u043b\u0438\u0441\u044f, \u0441\u043f\u043e\u0434\u0456\u0432\u0430\u0454\u043c\u043e\u0441\u044f, \u0432\u043e\u043d\u043e \u0442\u043e\u0433\u043e \u043a\u043e\u0448\u0442\u0443\u0432\u0430\u043b\u043e!",
exportByTime:"\u0415\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0437\u0430 \u0447\u0430\u0441\u043e\u043c",exportByMessages:"\u0415\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0437\u0430 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f\u043c",warning:"\u0423\u0432\u0430\u0433\u0430! \u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u043e\u0431\u0440\u043e\u0431\u0438\u0442\u0438 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",
friendsOnly:"\u0412\u0440\u0430\u0445\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0442\u0456\u043b\u044c\u043a\u0438 \u0434\u0440\u0443\u0437\u0456\u0432",withSelected:"\u0412\u0438\u0431\u0440\u0430\u043d\u0456",exportToNote:"\u0435\u043a\u0441\u043f\u043e\u0440\u0442\u0443\u0432\u0430\u0442\u0438 \u0432 \u0437\u0430\u043c\u0456\u0442\u043a\u0443",ourGroup:"\u041d\u0430\u0448\u0430 \u0433\u0440\u0443\u043f\u0430",noteSuccess:"\u0417\u0430\u043c\u0456\u0442\u043a\u0430 \u0443\u0441\u043f\u0456\u0448\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0430",
noteFailure:"\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0437\u0430\u043c\u0456\u0442\u043a\u0443. \u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u043f\u0456\u0437\u043d\u0456\u0448\u0435.",seeNote:"\u041f\u043e\u0434\u0438\u0432\u0438\u0442\u0438\u0441\u044f",plotKbytesGraph:"\u043f\u043e\u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0433\u0440\u0430\u0444\u0456\u043a \u0437\u0430 \u043a\u0456\u043b\u044c\u043a\u0456\u0441\u0442\u044e \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",
plotMessagesGraph:"\u043f\u043e\u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0433\u0440\u0430\u0444\u0456\u043a \u0437\u0430 \u043a\u0456\u043b\u044c\u043a\u0456\u0441\u0442\u044e \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",wantToPlotGraphs:"\u042f \u0437\u0430\u0445\u043e\u0447\u0443 \u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0433\u0430\u0440\u043d\u0456 \u0433\u0440\u0430\u0444\u0456\u043a\u0438",totalFirstName:"\u0417\u0430\u0433\u0430\u043b\u044c\u043d\u0430",
totalLastName:"\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430",sortByKBytes:"C\u043e\u0440\u0442\u0443\u0432\u0430\u0442\u0438 \u043f\u043e \u043a\u0456\u043b\u043e\u0431\u0430\u0439\u0442\u0430\u043c",hideAvatars:"\u041d\u0435 \u043f\u043e\u043a\u0430\u0437\u0443\u0432\u0430\u0442\u0438 \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0456\u0457"}},3:{name:"english",strings:{authorizing:"Authorizing",authorized:"Authorization complete",loadingMessageNumbers:"Getting message numbers",
fatal:"Fatal error. Please, send the info below to the developers",appName:"Private messages statistics",settingsText:"Set your desired parameters",startButton:"Start",verbose:"Verbose mode",kbytes:"Count message sizes as well",nameCol:"Name",numberOfMessagesCol:"Number of messages",gettingNames:"Loading user names",sentCol:"Sent",receivedCol:"Received",symbolsCol:"Total symbols",sentSymbolsCol:"Sent symbols",receivedSymbolsCol:"Received symbols",lastMsgCol:"Last Message",messagesProcessed:"Messages processed",
processingMessages:"Processing messages",done:"Processing complete",incoming:"incoming",outgoing:"outgoing",dayWithMostMessages:"Day with most messages",timeWithMostMessages:"Time with most messages",thankYou:"Thank you for your time, we hope it was worth it!",exportByTime:"Export time statistics",exportByMessages:"Export message statistics",warning:"Warning! Failed to process messages",friendsOnly:"Count only for friends",withSelected:"Selected",exportToNote:"export to note",ourGroup:"Our club",
noteSuccess:"Note created successfully",noteFailure:"Failed to create a note. Please try again later",seeNote:"See it",plotKbytesGraph:"plot symbol number graph",plotMessagesGraph:"plot message number graph",wantToPlotGraphs:"I'd like to plot fancy graphs",totalFirstName:"Overall",totalLastName:"stats",sortByKBytes:"Sort by kilobytes",hideAvatars:"Hide user photos"}}},fatal:function(a){ui.setHeader(user.lang.fatal);ui.clearContent();var b=ce("textarea",{cols:80,rows:20},{fontFamily:"Courier new"});
b.innerHTML=a;ui.appendContentElement(b);throw a;},log:function(a){var a=formatDate(new Date,!0)+": "+a,b=ge("loggerPane");if(void 0==b||null==b)ui.addLoggerPane(),b=ge("loggerPane");b.innerHTML+=a+"\n";b.scrollTop=b.scrollHeight}},user={lang:void 0==SYS.LANGUAGES[langConfig.id]?SYS.LANGUAGES[3].strings:SYS.LANGUAGES[langConfig.id].strings,verbose:!1,kbytes:!0,friendsOnly:!1,plotGraphs:!0,sortByKBytes:!1,hideAvatars:!0},ui={progress_bar_width:600,setTitle:function(a){document.title=a},setHeader:function(a){show("header");
ge("title").innerHTML=a;this.setTitle(a)},setContent:function(a){ge("content").innerHTML=a},clearContent:function(){this.setContent("");removeClass(geByTag1("body"),"im_fixed_nav");removeClass(geByTag1("body"),"audio_fixed_nav")},addcss:function(a){var b=document.createElement("style");b.type="text/css";b.appendChild(document.createTextNode(a));document.getElementsByTagName("head")[0].appendChild(b)},appendContentElement:function(a){ge("content").appendChild(a)},ProgressBar:function(a,b,e,d){a>b&&
(a=b);var j=(100*a/b).toFixed(2),a=a/b*e,d=(d||"%").replace("%",j+"%");return html='<div class="vkprogbar_container" style="width:'+(e+4)+'px;">\t\t\t\t\t<div class="vkprogbar vkpbframe" style="width: '+a+'px;">\t\t\t\t\t\t<div class="vkprogbar vkprogbarfr" style="width: '+e+'px;">'+d+'</div>\t\t\t\t\t</div>\t\t\t\t\t<div  class="vkprogbar vkprogbarbgframe" style="width: '+e+'px;">\t\t\t\t\t\t<div class="vkprogbar vkprogbarbg" style="width: '+e+'px;">'+d+"</div>\t\t\t\t\t</div>\t\t\t\t</div>"},createProgressBar:function(a){ui.addcss('\t\t\t.vkprogbar_container{margin:0 auto;}\t\t\t/*\t\t\t.vkprogbar{height:30px;  text-align:center;line-height:30px;}\t\t\t.vkprogbarfr{ box-shadow: inset 0 10px 26px rgba(255, 255, 255, 0.5); background-color: #6d8fb3; color:#fff; text-shadow: 0px 1px 0px #45688e;   border-style: solid;  border-width: 1px;  border-color: #7e9cbc #5c82ab #5c82ab;}\t\t\t.vkpbframe{position:absolute; border:1px solid #36638e; overflow:hidden}\t\t\t.vkprogbarbgframe{ box-shadow: inset 0 10px 26px rgba(255, 255, 255, 0.5); background-color: #eee; border:1px solid #ccc;}\t\t\t.vkprogbarbg{text-shadow: 0px 1px 0px #fff; border:1px solid #eee;}\t\t\t*/\t\t\t.vkprogbar{height:19px;  text-align:center;line-height:17px; font-size:10px;}\t\t\t.vkprogbarfr{ background-image:url("/images/progress_grad.gif"); background-color: #6D8FB3; color:#FFF; text-shadow: 0px 1px 0px #45688E;   border-style: solid;  border-width: 1px;  border-color: #7E9CBC #5C82AB #5C82AB;}\t\t\t.vkpbframe{position:absolute; border:1px solid #36638e; overflow:hidden}\t\t\t.vkprogbarbgframe{ background-color: #EEE; border:1px solid #ccc;}\t\t\t.vkprogbarbg{text-shadow: 0px 1px 0px #FFF; border:1px solid #EEE; box-shadow: inset 0 10px 26px rgba(255, 255, 255, 0.5); }\t\t');
a=ce("div",{id:"progressbar",innerHTML:ui.ProgressBar(0,1,this.progress_bar_width,a||" ")},{padding:"10px"});this.clearContent();this.appendContentElement(a)},updateProgressBar:function(a,b,e,d){var j=a+e,i=b+d,c=100*j/i,a=user.lang.messagesProcessed+": "+user.lang.incoming+": "+a+"/"+b+"; "+user.lang.outgoing+": "+e+"/"+d;ge("progressbar").innerHTML=ui.ProgressBar(j,i,this.progress_bar_width,a);this.setTitle(Math.floor(c)+"% "+user.lang.processingMessages)},sortBy:function(a,b){"tot-size"==b&&a.sort(function(a,
b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inSize+b.outSize-(a.inSize+a.outSize)});"in-size"==b&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inSize-a.inSize});"out-size"==b&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.outSize-a.outSize});"tot"==b&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inM+b.outM-(a.inM+a.outM)});"in"==b&&a.sort(function(a,b){a=
statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inM-a.inM});"out"==b&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.outM-a.outM});"date"==b&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.lastMessageDate-a.lastMessageDate});return a},displayStats:function(a,b,e){cur.messCheckedNum=0;actionsShown=!1;this.clearContent();handlePageView({width:950});b=ce("div",{className:"mailbox"});b.innerHTML+='<div id="mail_top_msg" class="message" style="display:none;"> </div> ';
this.appendContentElement(b);user.verbose&&SYS.log("Processing complete, rendering results");var d=ce("div",{id:"mail_bar",className:"clear_fix bar bar clearFix actionBar",innerHTML:'<div id="vkstats_text"><span>'+user.lang.thankYou+"</span>"+(0<messageProcessor.failed?" "+user.lang.warning+": "+messageProcessor.failed:"")+'<div style="float:right"> &copy; <a href="'+SYS.LINK_TO_CLUB+'" target="_blank">vkontakte-stats</a>, 2010 &ndash; 2011</div></div>'}),j=ce("div",{id:"mail_bar_act",innerHTML:'<span class="fl_l" style="padding-top:4px;">'+
user.lang.withSelected+": </span>","class":"fl_l"},{display:"none",paddingTop:"5px"});j.innerHTML+='<span id="mail_summary" style="display:none;"></span>';j.innerHTML+='<div class="button_gray fl_l"><button onclick="statCounter.exportToNote();">'+user.lang.exportToNote+"</button></div>";user.plotGraphs&&(iHTML='<span id="plot_graphs_links">',iHTML+='<div class="button_gray fl_l" id="plot_msg_graph_link"><button onclick="ui.plotGraph(false);">'+user.lang.plotMessagesGraph+"</button></div>",user.kbytes&&
(iHTML+='<div class="button_gray fl_l" id="plot_kb_graph_link"><button onclick="ui.plotGraph(true);">'+user.lang.plotKbytesGraph+"</button></div>"),j.innerHTML+=iHTML+"</span>");d.appendChild(ce("div",{id:"graph"},{display:"none",width:"100%",height:"400px"}));d.appendChild(j);b.appendChild(d);j=ce("div",{id:"mail_rows"});d=ce("table",{cellspacing:"0",cellpadding:"0",id:"mail_rows_t"},{width:"100%"});j.appendChild(d);b.appendChild(j);tableHTML='<thead><th class="mail_check" onmouseover="mail.checkOver(this, 0)" onmouseout="mail.checkOut(this, 0)" onclick="myCheckChange(this, 0)"><div class=""></div><input type="hidden" id="post_check_0"></th><th style="text-align: center, width: 30px"> </th><th class="messagePicture"> </th><th class="messageFrom">'+
user.lang.nameCol+'</th><th onclick="javascript: ui.sort(\'tot\');" style="cursor: pointer">'+user.lang.numberOfMessagesCol+'</th><th onclick="javascript: ui.sort(\'out\');" style="cursor: pointer">'+user.lang.sentCol+'</th><th onclick="javascript: ui.sort(\'in\');" style="cursor: pointer">'+user.lang.receivedCol+"</th>";user.kbytes&&(tableHTML+='<th onclick="javascript: ui.sort(\'tot-size\');" style="cursor: pointer">'+user.lang.symbolsCol+'</th><th onclick="javascript: ui.sort(\'out-size\');" style="cursor: pointer">'+
user.lang.sentSymbolsCol+'</th><th onclick="javascript: ui.sort(\'in-size\');" style="cursor: pointer">'+user.lang.receivedSymbolsCol+"</th>");tableHTML+='<th onclick="javascript: ui.sort(\'date\');" style="cursor: pointer">'+user.lang.lastMsgCol+"</th></thead>";d.innerHTML=tableHTML;b=ce("tbody");d.appendChild(b);a=[statCounter.ALL_ID].concat(this.sortBy(getKeys(a),e));for(e=0;e<a.length;e++){var i=a[e];sdata=statCounter.getStatData(i);udata=statCounter.getUserData(i);var d=ce("tr",{id:"mess"+i}),
j=ce("td",{innerHTML:i==statCounter.ALL_ID?"":e},{textAlign:"center",width:"30px"}),c=ce("td",{innerHTML:'<div class=""></div><input type="hidden" id="post_check_'+i+'">',className:"mail_check"});c.setAttribute("onmouseover","mail.checkOver(this, '"+i+"')");c.setAttribute("onmouseout","mail.checkOut(this, '"+i+"')");c.setAttribute("onclick","myCheckChange(this, '"+i+"')");var f=ce("td",{innerHTML:i==statCounter.ALL_ID?"":!user.hideAvatars?'<a href="/id'+i+'" target="_blank"><img src="'+(udata.photo?
udata.photo:"/images/question_c.gif")+'" /></a>':"",className:"messagePicture"}),i=ce("td",{innerHTML:(i==statCounter.ALL_ID?"":'<a href="/id'+i+'" target="_blank">')+udata.first_name+" "+udata.last_name+(i==statCounter.ALL_ID?"":"</a>"),className:"messageFrom"}),h=ce("td",{innerHTML:sdata.inM+sdata.outM}),g=ce("td",{innerHTML:sdata.outM}),l=ce("td",{innerHTML:sdata.inM});if(user.kbytes)var k=ce("td",{innerHTML:sdata.inSize+sdata.outSize}),m=ce("td",{innerHTML:sdata.outSize}),n=ce("td",{innerHTML:sdata.inSize});
var p=ce("td",{innerHTML:'<a href="mail.php?act=show&id='+sdata.lastMessageId+'" target="_blank">'+formatDate(new Date(1E3*sdata.lastMessageDate))+"</a>"});d.appendChild(c);d.appendChild(j);d.appendChild(f);d.appendChild(i);d.appendChild(h);d.appendChild(g);d.appendChild(l);user.kbytes&&(d.appendChild(k),d.appendChild(m),d.appendChild(n));d.appendChild(p);b.appendChild(d)}},sort:function(a){this.displayStats(statCounter.statByUser,statCounter.userData,a)},requestSettings:function(){this.setHeader(user.lang.appName+
" "+SYS.VERSION);ui.clearContent();this.removeLoggerPane();var a=new MessageBox({title:user.lang.settingsText});a.addButton(user.lang.startButton,function(){a.hide();messageProcessor.start()});var b;b='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_verbose" /></div><div style="width: 300px; height: 30px;"><input type="hidden" id="param_kbytes" /></div><div style="width: 300px; height: 30px;"><input type="hidden" id="param_sort_kbytes" /></div>';b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_friends_only" /></div>';
b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_fancy_graphs" /></div>';b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_hide_avatars" /></div>';a.content(b).show();new Checkbox(ge("param_verbose"),{label:user.lang.verbose,checked:0,onChange:function(){user.verbose=!user.verbose}});new Checkbox(ge("param_kbytes"),{label:user.lang.kbytes,checked:1,onChange:function(){user.kbytes=!user.kbytes}});new Checkbox(ge("param_sort_kbytes"),{label:user.lang.sortByKBytes,
checked:0,onChange:function(){user.sortByKBytes=!user.sortByKBytes}});new Checkbox(ge("param_friends_only"),{label:user.lang.friendsOnly,checked:0,onChange:function(){user.friendsOnly=!user.friendsOnly}});new Checkbox(ge("param_fancy_graphs"),{label:user.lang.wantToPlotGraphs,checked:1,onChange:function(){user.plotGraphs=!user.plotGraphs}});new Checkbox(ge("param_hide_avatars"),{label:user.lang.hideAvatars,checked:1,onChange:function(){user.hideAvatars=!user.hideAvatars}})},addLoggerPane:function(){var a=
ce("textarea",{cols:80,rows:20,id:"loggerPane"},{fontFamily:"Courier new"});insertAfter(a,ge("content"))},removeLoggerPane:function(){var a=ge("loggerPane");void 0!=a&&a.parentNode.removeChild(a)},onNoteNotCreated:function(){ge("mail_top_msg").innerHTML="<div>"+user.lang.noteFailure+"</div>";show("mail_top_msg")},onNoteCreated:function(a){ge("mail_top_msg").innerHTML="<div>"+user.lang.noteSuccess+'. <a href="/note'+user.uid+"_"+a+'" target="_blank">'+user.lang.seeNote+"</a></div>";show("mail_top_msg")},
sentColors:[6806590,15976256,15747131],receivedColors:[8374630,15584101,15754329],plotGraph:function(a){ge("graph").style.display="";var b={isRTL:window.is_rtl,"lang.select_graphs":fixQuot("filter"),"lang.months":fixQuot("January,February,March,April,May,June,July,August,September,October,November,December"),"lang.dayMonths":fixQuot("January,February,March,April,May,June,July,August,September,October,November,December"),"lang.dateFormats.day_fullmon_year_hour":fixQuot("{day} {dayMonth} {year}, {hour12}:00"),
"lang.dateFormats.day_fullmon_year":fixQuot("{month} {day}, {year}"),"lang.dateFormats.day_mon":fixQuot("{day} {month}"),"lang.dateFormats.day_fullmon":fixQuot("{day} {month}"),"lang.loading":fixQuot("Loading..."),"lang.no_data":fixQuot("No input data"),"lang.data_empty":fixQuot("Input data is empty"),"lang.error_loading":fixQuot("Loading error")};flashVars=clone(b);for(var b=ge("mail_rows_t"),e="[",d=0,j=0;j<b.rows.length;++j){var i=b.rows[j];if((i=i.id?intval(i.id.replace(/^mess/,"")):0)&&cur.messChecked[i]){0<
d&&(e+=",");if(a)var c=0,f=0,h='{"c": '+this.receivedColors[d]+',"f": 0, "d": [',g='{"c": '+this.sentColors[d]+',"f": 0, "d": [';else var l=0,k=0,m='{"c": '+this.sentColors[d]+',"f": 0, "d": [',n='{"c": '+this.receivedColors[d]+',"f": 0, "d": [';for(var p in statCounter.getStatData(i).history){var q=statCounter.getStatData(i).history[p];a?(c+=q.outSize,f+=q.inSize,g+="["+p+","+c+"],",h+="["+p+","+f+"],"):(l+=q.outM,k+=q.inM,m+="["+p+","+l+"],",n+="["+p+","+k+"],")}a?(g+="["+statCounter.lastMessageTime+
","+c+']], "name": "'+statCounter.getUserData(i).first_name+" "+statCounter.getUserData(i).last_name+": "+user.lang.sentCol+'"}',h+="["+statCounter.lastMessageTime+","+f+']], "name": "'+statCounter.getUserData(i).first_name+" "+statCounter.getUserData(i).last_name+": "+user.lang.receivedCol+'"}',e+=g+","+h):(m+="["+statCounter.lastMessageTime+","+l+']], "name": "'+statCounter.getUserData(i).first_name+" "+statCounter.getUserData(i).last_name+": "+user.lang.sentCol+'"}',n+="["+statCounter.lastMessageTime+
","+k+']], "name": "'+statCounter.getUserData(i).first_name+" "+statCounter.getUserData(i).last_name+": "+user.lang.receivedCol+'"}',e+=m+","+n);d++}}flashVars.graphdata=fixQuot(e+"]");user.verbose&&SYS.log("plotting: "+flashVars.graphdata);flashVars.div_id="graph";renderFlash("graph",{url:"/swf/graph.swf?0.28",id:"graph",width:"100%",height:400,version:8},{allowfullscreen:"true"},flashVars)}},statCounter={statByUser:{},userData:{},lastMessageTime:0,overallStats:{inM:0,outM:0,lastMessageDate:0,lastMessageId:0,
inSize:0,outSize:0,history:{}},ALL_ID:-1,createEmptyStatsFor:function(a){var b={inM:0,outM:0,lastMessageDate:a.date,lastMessageId:a.mid,inSize:0,outSize:0,history:{}};return this.statByUser[a.uid]=b},updateStats:function(a,b){b.lastMessageDate<a.date&&(b.lastMessageDate=a.date,b.lastMessageId=a.mid);statCounter.lastMessageTime<a.date&&(statCounter.lastMessageTime=a.date);a.out?(b.outM++,b.outSize+=a.body.length):(b.inM++,b.inSize+=a.body.length);user.plotGraphs&&(b.history[a.date]={inM:a.out?0:1,
outM:a.out?1:0,inSize:a.out?0:a.body.length,outSize:a.out?a.body.length:0})},processSingleMessage:function(a){userStats=this.statByUser[a.uid];void 0==userStats&&(userStats=this.createEmptyStatsFor(a));this.updateStats(a,userStats);this.updateStats(a,this.overallStats)},getStatData:function(a){return a==this.ALL_ID?this.overallStats:this.statByUser[a]},getUserData:function(a){return a==this.ALL_ID?{first_name:user.lang.totalFirstName,last_name:user.lang.totalLastName}:void 0==this.userData[a]?{first_name:"DELETED",
last_name:"DELETED"}:this.userData[a]},generateNoteContents:function(){var a;a="[[club21792535|vkontakte-stats]]\n\n{|\n|-\n";a+="! ";a+="!! "+user.lang.nameCol;a+="!! "+user.lang.numberOfMessagesCol;a+="!! "+user.lang.sentCol;a+="!! "+user.lang.receivedCol;user.kbytes&&(a+="!! "+user.lang.symbolsCol,a+="!! "+user.lang.sentSymbolsCol,a+="!! "+user.lang.receivedSymbolsCol);a+="\n";for(var b=0,e=ge("mail_rows_t"),d=0;d<e.rows.length;++d){var j=e.rows[d],j=j.id?j.id.replace(/^mess/,""):0;0!=j&&(j!=this.ALL_ID&&
b++,cur.messChecked[j]&&(sdata=this.getStatData(j),udata=this.getUserData(j),a+="|-\n",a+="| "+(j!=this.ALL_ID?b:"")+"\n",a+="| [[id"+j+"|"+udata.first_name+" "+udata.last_name+"]]\n",a+="| "+(sdata.inM+sdata.outM)+"\n",a+="| "+sdata.outM+"\n",a+="| "+sdata.inM+"\n",user.kbytes&&(a+="| "+(sdata.inSize+sdata.outSize)+"\n",a+="| "+sdata.outSize+"\n",a+="| "+sdata.inSize+"\n")))}return a+="|}\n"},exportToNote:function(){apiConnector.createNote(user.lang.appName,this.generateNoteContents(),function(a){void 0==
a.response?(SYS.log("Note creationg failed!"+rt),ui.onNoteNotCreated()):(a=a.response.nid,user.verbose&&SYS.log("Note created: "+a),ui.onNoteCreated(a))})}},messageProcessor={incomingMessages:void 0,processedIncomingMessages:0,outgoingMessages:void 0,processedOutgoingMessages:0,failed:0,onUserProfilesLoaded:function(a){void 0==a.response&&SYS.fatal(response);for(var a=a.response,b=0;b<a.length;b++)statCounter.userData[a[b].uid]=a[b];ui.setHeader(user.lang.done+"!");ui.displayStats(statCounter.statByUser,
statCounter.userData,user.kbytes&&user.sortByKBytes?"tot-size":"tot")},onAllMessagesLoaded:function(){ui.updateProgressBar(this.processedIncomingMessages,this.incomingMessages,this.processedOutgoingMessages,this.outgoingMessages);ui.setHeader(user.lang.gettingNames+"...");user.verbose&&SYS.log("Got all messages, getting user names");this.api.getUserNames(getKeys(statCounter.statByUser),messageProcessor.onUserProfilesLoaded)},onMessagesLoaded:function(a,b){var e=0;if(void 0==a)this.failed+=SYS.MESSAGES_PER_REQUEST,
SYS.log("Skipping "+SYS.MESSAGES_PER_REQUEST+" messages..."),b?this.processedOutgoingMessages+=SYS.MESSAGES_PER_REQUEST:this.processedIncomingMessages+=SYS.MESSAGES_PER_REQUEST,e=this.offset+SYS.MESSAGES_PER_REQUEST;else if(void 0!=a.response){var e=a.response,d=e[0];user.verbose&&SYS.log("Got "+(e.length-1)+" messages");for(var j=1;j<e.length;j++)statCounter.processSingleMessage(e[j]);if(b){if(this.processedOutgoingMessages+=e.length-1,e=this.processedOutgoingMessages+(d-this.outgoingMessages),d!=
this.outgoingMessages&&user.verbose&&SYS.log("By the way, the user has sent "+(d-this.outgoingMessages)+" message(s) after the script was started"),e>=d||SYS.DEBUG&&e>=SYS.MESSAGES_TO_PROCESS_IN_DEBUG_MODE){this.onAllMessagesLoaded();return}}else if(this.processedIncomingMessages+=e.length-1,e=this.processedIncomingMessages+(d-this.incomingMessages),d!=this.incomingMessages&&user.verbose&&SYS.log("By the way, the user has received "+(d-this.incomingMessages)+" message(s) after the script was started"),
e>=d||SYS.DEBUG&&e>=SYS.MESSAGES_TO_PROCESS_IN_DEBUG_MODE)b=1,e=0;ui.updateProgressBar(this.processedIncomingMessages,this.incomingMessages,this.processedOutgoingMessages,this.outgoingMessages)}else b=this.out,e=this.offset;d=(new Date).getTime()-this.requestStartTime;user.verbose&&SYS.log("Elapsed time:  "+d+" ms");d>=SYS.MSEC_BETWEEN_REQUESTS?(user.verbose&&SYS.log("Starting new request..."),this.requestStartTime=(new Date).getTime(),this.api.getMessages(b,e,SYS.MESSAGES_PER_REQUEST,function(a){messageProcessor.onMessagesLoaded(a,
b)})):(this.out=b,this.offset=e,user.verbose&&SYS.log("Scheduling new request in "+(SYS.MSEC_BETWEEN_REQUESTS-d)+"ms"),setTimeout("messageProcessor.requestStartTime = (new Date()).getTime(); messageProcessor.api.getMessages(messageProcessor.out, messageProcessor.offset, SYS.MESSAGES_PER_REQUEST, function(response) {messageProcessor.onMessagesLoaded(response, messageProcessor.out)});",SYS.MSEC_BETWEEN_REQUESTS-d))},startProcessingMessages:function(){ui.setHeader(user.lang.processingMessages+"...");
ui.createProgressBar(user.lang.processingMessages+"...");ui.updateProgressBar(0,this.incomingMessages,0,this.outgoingMessages);this.requestStartTime=(new Date).getTime();this.api.getMessages(0,0,SYS.MESSAGES_PER_REQUEST,function(a){messageProcessor.onMessagesLoaded(a,0)})},onMessageNumbersLoaded:function(a,b){var e=a.response;user.verbose&&SYS.log("Loaded message numbers ["+b+"]: "+e[0]);b?this.outgoingMessages=e[0]:this.incomingMessages=e[0];void 0!=this.incomingMessages&&void 0!=this.outgoingMessages&&
setTimeout(function(){messageProcessor.startProcessingMessages()},SYS.MSEC_BETWEEN_REQUESTS)},getNumberOfMessages:function(){this.api.getMessages(0,0,1,function(a){messageProcessor.onMessageNumbersLoaded(a,0)});setTimeout(function(){apiConnector.getMessages(1,0,1,function(a){messageProcessor.onMessageNumbersLoaded(a,1)})},2*SYS.MSEC_BETWEEN_REQUESTS)},start:function(){this.api=apiConnector;user.verbose&&(ui.addLoggerPane(),SYS.log("Started"));ui.setHeader(user.lang.loadingMessageNumbers);this.getNumberOfMessages()}},
vk_api={API_ID:SYS.APP_ID,SETTINGS:SYS.LOGIN_SETTING,NOT_USED_SETTING:32768,allow_call:!0,auth_frame:null,log:function(){},Auth:function(a){var b=vk_api.API_ID,e=vk_api.SETTINGS;vk_api.ajax("/login.php?app="+vk_api.API_ID+"&layout=popup&type=browser&settings="+vk_api.SETTINGS,{},function(d,j){if(-1!=j.indexOf("Login success"))vk_api.onAuth(a);else if(vk_api.auth_frame)setTimeout(function(){vk_api.Auth(a)},2E3);else{vk_api.auth_frame=ce("iframe",{src:"/login.php?app="+b+"&layout=popup&type=browser&settings="+
e},{position:"relative",width:"530px",height:"400px",border:"0px"});vk_api.auth_frame.onload=function(){vk_api.onAuth(a)};vk_api.aBox=new MessageBox({title:0,width:"560px",onHide:function(){var a=vk_api.auth_frame;vk_api.auth_frame=null;re(a)}});var i=vk_api.aBox;i.removeButtons();i.addButton(getLang("box_close"),i.hide);i.content('<div id="vk_api_auth"></div>');i.show();ge("vk_api_auth").appendChild(vk_api.auth_frame)}})},onAuth:function(a){var b=function(b,d){var j="{"+d.split("app_session = {")[1].split("}")[0]+
"}";sessionInfo=eval("("+j+")");vk_api.mid=sessionInfo.mid;vk_api.secret=sessionInfo.secret;vk_api.sid=sessionInfo.sid;a&&a(vk_api.mid,vk_api.secret,vk_api.sid)};vk_api.ajax("/login.php?app="+vk_api.API_ID+"&layout=popup&type=browser&settings="+vk_api.SETTINGS,{},function(a,d){if(-1!=d.indexOf("Login failure"))SYS.fatal("failed to log on. ");else if(-1!=d.indexOf("Login success")||""==d)vk_api.aBox&&(vk_api.aBox.hide(),vk_api.aBox=null),vk_api.ajax("/login.php?app="+vk_api.API_ID+"&layout=popup&type=browser&settings="+
vk_api.NOT_USED_SETTING,{},b)})},show_error:function(a){topError(a.error.error_msg+"<br>error_code: "+a.error.error_code,{dt:2})},call:function(a,b,e,d){function j(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0}function i(){l.sig=md5(n);l.sid=h;vk_api.log("api.call("+a+(window.JSON?", "+JSON.stringify(b):"")+")");vk_api.ajax("/api.php",l,function(h,f){""==f&&(f="{}");var g=eval("("+f+")");g.error?6==g.error.error_code?setTimeout(function(){vk_api.call(a,b,e)},500):4==g.error.error_code||3==g.error.error_code||
7==g.error.error_code?c():14==g.error.error_code?vk_api.captcha(g.error.captcha_sid,g.error.captcha_img,function(d,c){b.captcha_sid=d;b.captcha_key=c;vk_api.call(a,b,e,!0)},!1,function(){e(g)}):(vk_api.show_error(g),d&&vk_api_captchaBox.hide(),e(g,g.response,g.error)):(d&&vk_api_captchaBox.hide(),e(g))})}2==arguments.length&&(e=b,b={});if(vk_api.allow_call){vk_api.allow_call=!1;vk_api.allow_t=setTimeout("vk_api.allow_call=true;",300);var c=function(){vk_api.Auth(function(){vk_api.call(a,b,e)})},f=
vk_api.mid,h=vk_api.sid,g=vk_api.secret;if(!vk_api.sid||!vk_api.secret||!vk_api.mid||vk_api.mid!=vk.id)c();else{var l={api_id:vk_api.API_ID,method:a,v:"3.0",format:"json"};if(b)for(var k in b)l[k]=b[k];var m=[];for(k in l)m.push([k,l[k]]);m.sort(j);var n=f;for(k in m)n+=m[k][0]+"="+m[k][1];n+=g;i()}}else setTimeout(function(){vk_api.call(a,b,e)},300)},captcha:function(a,b,e,d,j){var i=vk_api_captchaBox=new MessageBox({title:getLang("captcha_enter_code"),width:300});i.removeButtons();var c,f=f||"/",
h=function(){removeEvent(c,"keypress");e(a,c.value);hide("captchaKey");show("captchaLoader")};i.addButton(getLang("captcha_cancel"),function(){removeEvent(c,"keypress");i.hide()},"no");i.addButton(getLang("captcha_send"),h);i.setOptions({onHide:j,bodyStyle:"padding: 16px 14px"});i.content('<div style="text-align: center; height: 76px"><a href="#" id="refreshCaptcha"><img id="captchaImg" class="captchaImg" src="'+b+'"/></a><div></div><input id="captchaKey" class="inputText" name="captcha_key" type="text" style="width: 120px; margin: 3px 0px 0px;" maxlength="7"/><img id="captchaLoader" src="'+
f+'images/progress7.gif" style="display:none; margin-top: 13px;" /></div>');i.show();isFunction(d)&&d();c=ge("captchaKey");addEvent(c,"keypress",function(a){13==a.keyCode&&h()});addEvent(ge("refreshCaptcha"),"click",h);c.focus()},ajax:function(a,b,e){var d=null;try{d=new XMLHttpRequest}catch(j){d=null}try{d||(d=new ActiveXObject("Msxml2.XMLHTTP"))}catch(i){d=null}try{d||(d=new ActiveXObject("Microsoft.XMLHTTP"))}catch(c){d=null}if(!d)return!1;d.onreadystatechange=function(){4==d.readyState&&e&&e(d,
d.responseText)};d.open("POST",a,!0);d.setRequestHeader&&(d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.setRequestHeader("X-Requested-With","XMLHttpRequest"));d.send(function(a){var b=[];if(a instanceof Object){for(var d in a)b.push(encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return b.join("&")}return encodeURIComponent(a)}(b));return!0}};
apiConnector={getMessages_:function(a,b,e,d){user.verbose&&SYS.log("getMessages invoked: out="+a+"; offset="+b);vk_api.call("messages.get",{filters:user.friendsOnly?4:0,offset:b,out:a,preview_length:user.kbytes?0:1,count:e},d)},getMessages:function(a,b,e,d){user.verbose&&SYS.log("getMessages invoked: out="+a+"; offset="+b);var j=e,i=user.kbytes?0:1,c=user.friendsOnly?4:0;code_body="";code_r=[];steps=Math.ceil(e/100);for(var f=0;f<steps;f++)code_body+="var x"+f+"=API.messages.get("+to_json({count:100<
e?100:e,offset:b,filters:c,out:a,preview_length:i})+");\n",code_r.push("x"+f),e-=100,b+=100;code_body+="\nreturn ["+code_r.join(",")+"];";vk_api.call("execute",{code:code_body},function(a){for(var b=null,a=a.response,c=0;c<a.length;c++)if(b){if(a[c]&&0<a[c].length){var e=a[c];e.shift();for(var f=0;f<e.length;f++)b.push(e[f])}}else b=a[c];user.verbose&&(a=j-b.length+1,0<a&&SYS.log("Lost Messages count:"+a));d({response:b})})},doGetUserData:function(a,b){user.verbose&&SYS.log("doGetUserData invoked: ids="+
a);vk_api.call("getProfiles",{uids:a.join(","),fields:"photo"},b)},getUserNames:function(a,b,e){var a=splitArrayToSubArrays(a,SYS.MAX_USERS_PER_REQUEST),d=null,j=0,i=function(c){if(c&&c.response)if(d)for(var f=0;f<c.response.length;f++)d.response.push(c.response[f]);else d=c;a[j]?setTimeout(function(){e&&e(j);apiConnector.doGetUserData(a[j],i);j++},SYS.MSEC_BETWEEN_REQUESTS):b(d)};i()},createNote:function(a,b,e){user.verbose&&SYS.log("createNote:  title="+a+"; text="+b);vk_api.call("notes.add",{text:b,
title:a},e)}};SYS.VERSION="4.3.4";window.renderFlash?stManager.add(SYS.FILES_TO_LOAD,function(){window.dApi?(vk_api=dApi,user.uid=vk.id,ui.requestSettings()):vk_api.Auth(function(a){user.uid=a;ui.requestSettings()})}):alert(user.lang.wrongPage);
