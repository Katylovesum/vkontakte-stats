var getKeys=function(a){var b=[],c;for(c in a)b.push(c);return b},fixQuot=function(a){return browser.msie?a.replace(/\"/g,"&quot;"):a},nKeys=function(a){var b=0,c;for(c in a)b++;return b},splitArrayToSubArrays=function(a,b){for(var c=[],e=0;e<a.length/b;e++)c.push(a.slice(b*e,b*(e+1)));return c},formatDate=function(a,b){var c=a.getFullYear(),e=a.getMonth()+1;e<10&&(e="0"+e);var f=a.getDate();f<10&&(f="0"+f);var j=a.getHours();j<10&&(j="0"+j);var d=a.getMinutes();d<10&&(d="0"+d);var h=a.getSeconds();
h<10&&(h="0"+h);if(b){var g=mod(a.getTime(),1E3);g<100&&(g="0"+g);intval(g)<10&&(g="0"+g);h=h+"."+g}return c+"-"+e+"-"+f+" "+j+":"+d+":"+h},insertAfter=function(a,b){var c=b.nextSibling;c?c.parentNode.insertBefore(a,c):b.parentNode.appendChild(a)},mod=function(a,b){return a%b},myCheckChange=function(a,b){if(!cur.messChecked)cur.messChecked={};if(cur.messCheckedNum==null)cur.messCheckedNum=0;mail.checkChange(a,b);(cur.messCheckedNum>0?hide:show)("vkstats_text");cur.messCheckedNum>SYS.MAX_USERS_AT_ONE_GRAPH?
user.plotGraphs&&hide("plot_graphs_links"):user.plotGraphs&&show("plot_graphs_links")},rotateLeft=function(a,b){return a<<b|a>>>32-b},addUnsigned=function(a,b){var c,e,f,j,d;f=a&2147483648;j=b&2147483648;c=a&1073741824;e=b&1073741824;d=(a&1073741823)+(b&1073741823);if(c&e)return d^2147483648^f^j;return c|e?d&1073741824?d^3221225472^f^j:d^1073741824^f^j:d^f^j},F=function(a,b,c){return a&b|~a&c},G=function(a,b,c){return a&c|b&~c},H=function(a,b,c){return a^b^c},I=function(a,b,c){return b^(a|~c)},FF=
function(a,b,c,e,f,j,d){a=addUnsigned(a,addUnsigned(addUnsigned(F(b,c,e),f),d));return addUnsigned(rotateLeft(a,j),b)},GG=function(a,b,c,e,f,j,d){a=addUnsigned(a,addUnsigned(addUnsigned(G(b,c,e),f),d));return addUnsigned(rotateLeft(a,j),b)},HH=function(a,b,c,e,f,j,d){a=addUnsigned(a,addUnsigned(addUnsigned(H(b,c,e),f),d));return addUnsigned(rotateLeft(a,j),b)},II=function(a,b,c,e,f,j,d){a=addUnsigned(a,addUnsigned(addUnsigned(I(b,c,e),f),d));return addUnsigned(rotateLeft(a,j),b)},convertToWordArray=
function(a){var b,c=a.length;b=c+8;for(var e=((b-mod(b,64))/64+1)*16,f=Array(e-1),j=0,d=0;d<c;)b=(d-mod(d,4))/4,j=mod(d,4)*8,f[b]|=a.charCodeAt(d)<<j,d++;b=(d-mod(d,4))/4;j=mod(d,4)*8;f[b]|=128<<j;f[e-2]=c<<3;f[e-1]=c>>>29;return f},wordToHex=function(a){var b="",c="",e;for(e=0;e<=3;e++)c=a>>>e*8&255,c="0"+c.toString(16),b+=c.substr(c.length-2,2);return b},uTF8Encode=function(a){for(var a=a.replace(/\x0d\x0a/g,"\n"),b="",c=0;c<a.length;c++){var e=a.charCodeAt(c);e<128?b+=String.fromCharCode(e):(e>
127&&e<2048?b+=String.fromCharCode(e>>6|192):(b+=String.fromCharCode(e>>12|224),b+=String.fromCharCode(e>>6&63|128)),b+=String.fromCharCode(e&63|128))}return b},md5=function(a){var b=[],c,e,f,j,d,h,g,i,a=uTF8Encode(a),b=convertToWordArray(a);d=1732584193;h=4023233417;g=2562383102;i=271733878;for(a=0;a<b.length;a+=16)c=d,e=h,f=g,j=i,d=FF(d,h,g,i,b[a+0],7,3614090360),i=FF(i,d,h,g,b[a+1],12,3905402710),g=FF(g,i,d,h,b[a+2],17,606105819),h=FF(h,g,i,d,b[a+3],22,3250441966),d=FF(d,h,g,i,b[a+4],7,4118548399),
i=FF(i,d,h,g,b[a+5],12,1200080426),g=FF(g,i,d,h,b[a+6],17,2821735955),h=FF(h,g,i,d,b[a+7],22,4249261313),d=FF(d,h,g,i,b[a+8],7,1770035416),i=FF(i,d,h,g,b[a+9],12,2336552879),g=FF(g,i,d,h,b[a+10],17,4294925233),h=FF(h,g,i,d,b[a+11],22,2304563134),d=FF(d,h,g,i,b[a+12],7,1804603682),i=FF(i,d,h,g,b[a+13],12,4254626195),g=FF(g,i,d,h,b[a+14],17,2792965006),h=FF(h,g,i,d,b[a+15],22,1236535329),d=GG(d,h,g,i,b[a+1],5,4129170786),i=GG(i,d,h,g,b[a+6],9,3225465664),g=GG(g,i,d,h,b[a+11],14,643717713),h=GG(h,g,
i,d,b[a+0],20,3921069994),d=GG(d,h,g,i,b[a+5],5,3593408605),i=GG(i,d,h,g,b[a+10],9,38016083),g=GG(g,i,d,h,b[a+15],14,3634488961),h=GG(h,g,i,d,b[a+4],20,3889429448),d=GG(d,h,g,i,b[a+9],5,568446438),i=GG(i,d,h,g,b[a+14],9,3275163606),g=GG(g,i,d,h,b[a+3],14,4107603335),h=GG(h,g,i,d,b[a+8],20,1163531501),d=GG(d,h,g,i,b[a+13],5,2850285829),i=GG(i,d,h,g,b[a+2],9,4243563512),g=GG(g,i,d,h,b[a+7],14,1735328473),h=GG(h,g,i,d,b[a+12],20,2368359562),d=HH(d,h,g,i,b[a+5],4,4294588738),i=HH(i,d,h,g,b[a+8],11,2272392833),
g=HH(g,i,d,h,b[a+11],16,1839030562),h=HH(h,g,i,d,b[a+14],23,4259657740),d=HH(d,h,g,i,b[a+1],4,2763975236),i=HH(i,d,h,g,b[a+4],11,1272893353),g=HH(g,i,d,h,b[a+7],16,4139469664),h=HH(h,g,i,d,b[a+10],23,3200236656),d=HH(d,h,g,i,b[a+13],4,681279174),i=HH(i,d,h,g,b[a+0],11,3936430074),g=HH(g,i,d,h,b[a+3],16,3572445317),h=HH(h,g,i,d,b[a+6],23,76029189),d=HH(d,h,g,i,b[a+9],4,3654602809),i=HH(i,d,h,g,b[a+12],11,3873151461),g=HH(g,i,d,h,b[a+15],16,530742520),h=HH(h,g,i,d,b[a+2],23,3299628645),d=II(d,h,g,i,
b[a+0],6,4096336452),i=II(i,d,h,g,b[a+7],10,1126891415),g=II(g,i,d,h,b[a+14],15,2878612391),h=II(h,g,i,d,b[a+5],21,4237533241),d=II(d,h,g,i,b[a+12],6,1700485571),i=II(i,d,h,g,b[a+3],10,2399980690),g=II(g,i,d,h,b[a+10],15,4293915773),h=II(h,g,i,d,b[a+1],21,2240044497),d=II(d,h,g,i,b[a+8],6,1873313359),i=II(i,d,h,g,b[a+15],10,4264355552),g=II(g,i,d,h,b[a+6],15,2734768916),h=II(h,g,i,d,b[a+13],21,1309151649),d=II(d,h,g,i,b[a+4],6,4149444226),i=II(i,d,h,g,b[a+11],10,3174756917),g=II(g,i,d,h,b[a+2],15,
718787259),h=II(h,g,i,d,b[a+9],21,3951481745),d=addUnsigned(d,c),h=addUnsigned(h,e),g=addUnsigned(g,f),i=addUnsigned(i,j);return(wordToHex(d)+wordToHex(h)+wordToHex(g)+wordToHex(i)).toLowerCase()},SYS={VERSION:"4.2.1",APP_ID:2045168,LOGIN_SETTING:6144,DEBUG:!1,MESSAGES_TO_PROCESS_IN_DEBUG_MODE:400,MESSAGES_PER_REQUEST:100,MSEC_BETWEEN_REQUESTS:333,MSEC_BETWEEN_REQUESTS_FOR_USERDATA:1E3,MAX_USERS_PER_REQUEST:1E3,LINK_TO_CLUB:"/club21792535",TOO_MANY_REQUESTS_ERR_CODE:6,MAX_USERS_AT_ONE_GRAPH:3,FILES_TO_LOAD:["mail.css",
"mail.js","ui_controls.js","ui_controls.css","common.js"],LANGUAGES:{0:{name:"russian",strings:{authorizing:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f",authorized:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",loadingMessageNumbers:"\u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0447\u0438\u0441\u043b\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",fatal:"\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0441\u043e\u043e\u0431\u0449\u0438\u0442\u0435 \u043f\u0440\u0438\u0432\u0435\u0434\u0451\u043d\u043d\u044b\u0435 \u043d\u0438\u0436\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u0443.",
appName:"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043b\u0438\u0447\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0438",nameCol:"\u0418\u043c\u044f",kbytes:"\u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",settingsText:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0436\u0435\u043b\u0430\u0435\u043c\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b",
startButton:"\u041f\u043e\u0435\u0445\u0430\u043b\u0438!",verbose:"\u041b\u043e\u0433\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f",gettingNames:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0438\u043c\u0451\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439",numberOfMessagesCol:"\u0412\u0441\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",sentCol:"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e",
receivedCol:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e",symbolsCol:"\u0412\u0441\u0435\u0433\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",sentSymbolsCol:"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",receivedSymbolsCol:"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",lastMsgCol:"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",
processingMessages:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",done:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",messagesProcessed:"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",incoming:"\u0432\u0445\u043e\u0434\u044f\u0449\u0438\u0445",outgoing:"\u0438\u0441\u0445\u043e\u0434\u044f\u0449\u0438\u0445",
dayWithMostMessages:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0432\u0441\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0431\u044b\u043b\u043e",timeWithMostMessages:"\u0411\u043e\u043b\u044c\u0448\u0435 \u0432\u0441\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",thankYou:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e, \u0447\u0442\u043e \u0434\u043e\u0436\u0434\u0430\u043b\u0438\u0441\u044c, \u043d\u0430\u0434\u0435\u0435\u043c\u0441\u044f, \u043e\u043d\u043e \u0442\u043e\u0433\u043e \u0441\u0442\u043e\u0438\u043b\u043e!",
exportByTime:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u043f\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438",exportByMessages:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u043f\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f\u043c",warning:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",
friendsOnly:"\u0423\u0447\u0438\u0442\u044b\u0432\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u0440\u0443\u0437\u0435\u0439",withSelected:"\u0412\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0435",exportToNote:"\u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0437\u0430\u043c\u0435\u0442\u043a\u0443",ourGroup:"\u041d\u0430\u0448\u0430 \u0433\u0440\u0443\u043f\u043f\u0430",noteSuccess:"\u0417\u0430\u043c\u0435\u0442\u043a\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u0430",
noteFailure:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u043c\u0435\u0442\u043a\u0443. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437 \u043f\u043e\u0437\u0434\u043d\u0435\u0435.",seeNote:"\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c",plotKbytesGraph:"\u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a \u043f\u043e \u0447\u0438\u0441\u043b\u0443 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432",
plotMessagesGraph:"\u043f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a \u043f\u043e \u0447\u0438\u0441\u043b\u0443 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439",wantToPlotGraphs:"\u042f \u0437\u0430\u0445\u043e\u0447\u0443 \u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0433\u0440\u0430\u0444\u0438\u043a\u0438 \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043e\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438",totalFirstName:"\u041e\u0431\u0449\u0430\u044f",
totalLastName:"\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430",sortByKBytes:"\u0421\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u043a\u0438\u043b\u043e\u0431\u0430\u0439\u0442\u0430\u043c"}},1:{name:"ukrainian",strings:{authorizing:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u044f",authorized:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0456\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",loadingMessageNumbers:"\u0412\u0438\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u044f \u043a\u0456\u043b\u044c\u043a\u043e\u0441\u0442\u0456 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",
settingsText:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044c \u0431\u0430\u0436\u0430\u043d\u0456 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0438",startButton:"\u041f\u043e\u0457\u0445\u0430\u043b\u0438!",verbose:"\u041b\u043e\u0433\u0433\u0456\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0441\u0456 \u0434\u0456\u0457",fatal:"\u041a\u0440\u0438\u0442\u0438\u0447\u043d\u0430 \u043f\u043e\u043c\u0438\u043b\u043a\u0430. \u0411\u0443\u0434\u044c \u043b\u0430\u0441\u043a\u0430, \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u0442\u0435 \u043d\u0430\u0432\u0435\u0434\u0435\u043d\u0456 \u043d\u0438\u0436\u0447\u0435 \u0434\u0430\u043d\u0456 \u0440\u043e\u0437\u0440\u043e\u0431\u043d\u0438\u043a\u0443.",
appName:"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u0456 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0438",nameCol:"\u0406\u043c'\u044f",numberOfMessagesCol:"\u0423\u0441\u044c\u043e\u0433\u043e \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",kbytes:"\u0412\u0440\u0430\u0445\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0440\u043e\u0437\u043c\u0456\u0440 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",
gettingNames:"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f \u0456\u043c\u0435\u043d \u043a\u043e\u0440\u0438\u0441\u0442\u0443\u0432\u0430\u0447\u0456\u0432",symbolsCol:"\u0412\u0441\u044c\u043e\u0433\u043e \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",sentSymbolsCol:"\u0412\u0438 \u0432\u0456\u0434\u043f\u0440\u0430\u0432\u0438\u043b\u0438 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",receivedSymbolsCol:"\u0412\u0438 \u043e\u0442\u0440\u0438\u043c\u0430\u043b\u0438 \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",
sentCol:"\u0412\u0438 \u0432\u0456\u0434\u043f\u0440\u0430\u0432\u0438\u043b\u0438",receivedCol:"\u0412\u0438 \u043e\u0434\u0435\u0440\u0436\u0430\u043b\u0438",lastMsgCol:"\u041e\u0441\u0442\u0430\u043d\u043d\u0454 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f",messagesProcessed:"\u041e\u0431\u0440\u043e\u0431\u043b\u0435\u043d\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",processingMessages:"\u041e\u0431\u0440\u043e\u0431\u043a\u0430 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",
done:"\u041e\u0431\u0440\u043e\u0431\u043a\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430",incoming:"\u0432\u0445\u043e\u0434\u044f\u0442\u044c",outgoing:"\u0432\u0438\u0445\u0456\u0434\u043d\u0438\u0445",dayWithMostMessages:"\u041d\u0430\u0439\u0431\u0456\u043b\u044c\u0448\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c \u0431\u0443\u043b\u043e",timeWithMostMessages:"\u041d\u0430\u0439\u0431\u0456\u043b\u044c\u0448\u0435 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",
thankYou:"\u0421\u043f\u0430\u0441\u0438\u0431\u0456, \u0449\u043e \u0434\u043e\u0447\u0435\u043a\u0430\u043b\u0438\u0441\u044f, \u0441\u043f\u043e\u0434\u0456\u0432\u0430\u0454\u043c\u043e\u0441\u044f, \u0432\u043e\u043d\u043e \u0442\u043e\u0433\u043e \u043a\u043e\u0448\u0442\u0443\u0432\u0430\u043b\u043e!",exportByTime:"\u0415\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0437\u0430 \u0447\u0430\u0441\u043e\u043c",exportByMessages:"\u0415\u043a\u0441\u043f\u043e\u0440\u0442 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0438 \u0437\u0430 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u043d\u044f\u043c",
warning:"\u0423\u0432\u0430\u0433\u0430! \u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u043e\u0431\u0440\u043e\u0431\u0438\u0442\u0438 \u043f\u043e\u0432\u0456\u0434\u043e\u043c\u043b\u0435\u043d\u044c",friendsOnly:"\u0412\u0440\u0430\u0445\u043e\u0432\u0443\u0432\u0430\u0442\u0438 \u0442\u0456\u043b\u044c\u043a\u0438 \u0434\u0440\u0443\u0437\u0456\u0432",withSelected:"\u0412\u0438\u0431\u0440\u0430\u043d\u0456",exportToNote:"\u0435\u043a\u0441\u043f\u043e\u0440\u0442\u0443\u0432\u0430\u0442\u0438 \u0432 \u0437\u0430\u043c\u0456\u0442\u043a\u0443",
ourGroup:"\u041d\u0430\u0448\u0430 \u0433\u0440\u0443\u043f\u0430",noteSuccess:"\u0417\u0430\u043c\u0456\u0442\u043a\u0430 \u0443\u0441\u043f\u0456\u0448\u043d\u043e \u0441\u0442\u0432\u043e\u0440\u0435\u043d\u0430",noteFailure:"\u041d\u0435 \u0432\u0434\u0430\u043b\u043e\u0441\u044f \u0441\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0437\u0430\u043c\u0456\u0442\u043a\u0443. \u0421\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437 \u043f\u0456\u0437\u043d\u0456\u0448\u0435.",
seeNote:"\u041f\u043e\u0434\u0438\u0432\u0438\u0442\u0438\u0441\u044f",plotKbytesGraph:"\u043f\u043e\u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0433\u0440\u0430\u0444\u0456\u043a \u0437\u0430 \u043a\u0456\u043b\u044c\u043a\u0456\u0441\u0442\u044e \u0441\u0438\u043c\u0432\u043e\u043b\u0456\u0432",plotMessagesGraph:"\u043f\u043e\u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0433\u0440\u0430\u0444\u0456\u043a \u0437\u0430 \u043a\u0456\u043b\u044c\u043a\u0456\u0441\u0442\u044e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0456\u0439\u044c",
wantToPlotGraphs:"\u042f \u0437\u0430\u0445\u043e\u0447\u0443 \u0431\u0443\u0434\u0443\u0432\u0430\u0442\u0438 \u0433\u0430\u0440\u043d\u0456 \u0433\u0440\u0430\u0444\u0456\u043a\u0438",totalFirstName:"\u0417\u0430\u0433\u0430\u043b\u044c\u043d\u0430",totalLastName:"\u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430",sortByKBytes:"C\u043e\u0440\u0442\u0443\u0432\u0430\u0442\u0438 \u043f\u043e \u043a\u0456\u043b\u043e\u0431\u0430\u0439\u0442\u0430\u043c"}},3:{name:"english",strings:{authorizing:"Authorizing",
authorized:"Authorization complete",loadingMessageNumbers:"Getting message numbers",fatal:"Fatal error. Please, send the info below to the developers",appName:"Private messages statistics",settingsText:"Set your desired parameters",startButton:"Start",verbose:"Verbose mode",kbytes:"Count message sizes as well",nameCol:"Name",numberOfMessagesCol:"Number of messages",gettingNames:"Loading user names",sentCol:"Sent",receivedCol:"Received",symbolsCol:"Total symbols",sentSymbolsCol:"Sent symbols",receivedSymbolsCol:"Received symbols",
lastMsgCol:"Last Message",messagesProcessed:"Messages processed",processingMessages:"Processing messages",done:"Processing complete",incoming:"incoming",outgoing:"outgoing",dayWithMostMessages:"Day with most messages",timeWithMostMessages:"Time with most messages",thankYou:"Thank you for your time, we hope it was worth it!",exportByTime:"Export time statistics",exportByMessages:"Export message statistics",warning:"Warning! Failed to process messages",friendsOnly:"Count only for friends",withSelected:"Selected",
exportToNote:"export to note",ourGroup:"Our club",noteSuccess:"Note created successfully",noteFailure:"Failed to create a note. Please try again later",seeNote:"See it",plotKbytesGraph:"plot symbol number graph",plotMessagesGraph:"plot message number graph",wantToPlotGraphs:"I'd like to plot fancy graphs",totalFirstName:"Overall",totalLastName:"stats",sortByKBytes:"Sort by kilobytes"}}},fatal:function(a){ui.setHeader(user.lang.fatal);ui.clearContent();var b=ce("textarea",{cols:80,rows:20},{fontFamily:"Courier new"});
b.innerHTML=a;ui.appendContentElement(b);throw a;},log:function(a){var a=formatDate(new Date,!0)+": "+a,b=ge("loggerPane");if(b==void 0||b==null)ui.addLoggerPane(),b=ge("loggerPane");b.innerHTML+=a+"\n";b.scrollTop=b.scrollHeight}},user={lang:SYS.LANGUAGES[langConfig.id]==void 0?SYS.LANGUAGES[3].strings:SYS.LANGUAGES[langConfig.id].strings,verbose:!1,kbytes:!0,friendsOnly:!1,plotGraphs:!0,sortByKBytes:!1},ui={progress_bar_width:600,setTitle:function(a){document.title=a},setHeader:function(a){show("header");
ge("title").innerHTML=a;this.setTitle(a)},setContent:function(a){ge("content").innerHTML=a},clearContent:function(){this.setContent("")},addcss:function(a){var b=document.createElement("style");b.type="text/css";b.appendChild(document.createTextNode(a));document.getElementsByTagName("head")[0].appendChild(b)},appendContentElement:function(a){ge("content").appendChild(a)},ProgressBar:function(a,b,c,e){a>b&&(a=b);var f=(a*100/b).toFixed(2),a=a/b*c,e=(e||"%").replace("%",f+"%");return html='<div class="vkprogbar_container" style="width:'+
(c+4)+'px;"><div class="vkprogbar vkpbframe" style="width: '+a+'px;"><div class="vkprogbar vkprogbarfr" style="width: '+c+'px;">'+e+'</div></div><div  class="vkprogbar vkprogbarbgframe" style="width: '+c+'px;"><div class="vkprogbar vkprogbarbg" style="width: '+c+'px;">'+e+"</div></div></div>"},createProgressBar:function(a){ui.addcss(".vkprogbar_container{margin:0 auto;}.vkprogbar{height:30px;  text-align:center;line-height:30px;}.vkprogbarfr{ background-color: #6d8fb3; color:#fff; text-shadow: 0px 1px 0px #45688e;   border-style: solid;  border-width: 1px;  border-color: #7e9cbc #5c82ab #5c82ab;}.vkpbframe{position:absolute; border:1px solid #36638e; overflow:hidden}.vkprogbarbgframe{ background-color: #eee; border:1px solid #ccc;}.vkprogbarbg{text-shadow: 0px 1px 0px #fff; border:1px solid #eee;}.vkprogressbarbg{background-color: #fff; border:1px solid #ccc}.vkprogressbarfr{background-color: #5c7893; border:1px solid #36638e; height: 14px;}");
a=ce("div",{id:"progressbar",innerHTML:ui.ProgressBar(0,1,this.progress_bar_width,a||" ")},{padding:"10px"});this.clearContent();this.appendContentElement(a)},updateProgressBar:function(a,b,c,e){var f=a+c,j=b+e,d=100*f/j,a=user.lang.messagesProcessed+": "+user.lang.incoming+": "+a+"/"+b+"; "+user.lang.outgoing+": "+c+"/"+e;ge("progressbar").innerHTML=ui.ProgressBar(f,j,this.progress_bar_width,a);this.setTitle(Math.floor(d)+"% "+user.lang.processingMessages)},sortBy:function(a,b){b=="tot-size"&&a.sort(function(a,
b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inSize+b.outSize-(a.inSize+a.outSize)});b=="in-size"&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inSize-a.inSize});b=="out-size"&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.outSize-a.outSize});b=="tot"&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inM+b.outM-(a.inM+a.outM)});b=="in"&&a.sort(function(a,b){a=
statCounter.statByUser[a];b=statCounter.statByUser[b];return b.inM-a.inM});b=="out"&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.outM-a.outM});b=="date"&&a.sort(function(a,b){a=statCounter.statByUser[a];b=statCounter.statByUser[b];return b.lastMessageDate-a.lastMessageDate});return a},displayStats:function(a,b,c){cur.messCheckedNum=0;actionsShown=!1;this.clearContent();handlePageView({width:950});b=ce("div",{className:"mailbox"});b.innerHTML+='<div id="mail_top_msg" class="message" style="display:none;"> </div> ';
this.appendContentElement(b);user.verbose&&SYS.log("Processing complete, rendering results");var e=ce("div",{id:"mail_bar",className:"clear_fix bar bar clearFix actionBar",innerHTML:'<div id="vkstats_text"><span>'+user.lang.thankYou+"</span>"+(messageProcessor.failed>0?" "+user.lang.warning+": "+messageProcessor.failed:"")+'<div style="float:right"> &copy; <a href="'+SYS.LINK_TO_CLUB+'" target="_blank">vkontakte-stats</a>, 2010 &ndash; 2011</div></div>'}),f=ce("div",{id:"mail_bar_act",innerHTML:'<span class="fl_l" style="padding-top:4px;">'+
user.lang.withSelected+": </span>","class":"fl_l"},{display:"none",paddingTop:"5px"});f.innerHTML+='<span id="mail_summary" style="display:none;"></span>';f.innerHTML+='<div class="button_gray fl_l"><button onclick="statCounter.exportToNote();">'+user.lang.exportToNote+"</button></div>";user.plotGraphs&&(iHTML='<span id="plot_graphs_links">',iHTML+='<div class="button_gray fl_l" id="plot_msg_graph_link"><button onclick="ui.plotGraph(false);">'+user.lang.plotMessagesGraph+"</button></div>",user.kbytes&&
(iHTML+='<div class="button_gray fl_l" id="plot_kb_graph_link"><button onclick="ui.plotGraph(true);">'+user.lang.plotKbytesGraph+"</button></div>"),f.innerHTML+=iHTML+"</span>");e.appendChild(ce("div",{id:"graph"},{display:"none",width:"100%",height:"400px"}));e.appendChild(f);b.appendChild(e);f=ce("div",{id:"mail_rows"});e=ce("table",{cellspacing:"0",cellpadding:"0",id:"mail_rows_t"},{width:"100%"});f.appendChild(e);b.appendChild(f);tableHTML='<thead><th class="mail_check" onmouseover="mail.checkOver(this, 0)" onmouseout="mail.checkOut(this, 0)" onclick="myCheckChange(this, 0)"><div class=""></div><input type="hidden" id="post_check_0"></th><th style="text-align: center, width: 30px"> </th><th class="messagePicture"> </th><th class="messageFrom">'+
user.lang.nameCol+'</th><th onclick="javascript: ui.sort(\'tot\');" style="cursor: pointer">'+user.lang.numberOfMessagesCol+'</th><th onclick="javascript: ui.sort(\'out\');" style="cursor: pointer">'+user.lang.sentCol+'</th><th onclick="javascript: ui.sort(\'in\');" style="cursor: pointer">'+user.lang.receivedCol+"</th>";user.kbytes&&(tableHTML+='<th onclick="javascript: ui.sort(\'tot-size\');" style="cursor: pointer">'+user.lang.symbolsCol+'</th><th onclick="javascript: ui.sort(\'out-size\');" style="cursor: pointer">'+
user.lang.sentSymbolsCol+'</th><th onclick="javascript: ui.sort(\'in-size\');" style="cursor: pointer">'+user.lang.receivedSymbolsCol+"</th>");tableHTML+='<th onclick="javascript: ui.sort(\'date\');" style="cursor: pointer">'+user.lang.lastMsgCol+"</th></thead>";e.innerHTML=tableHTML;b=ce("tbody");e.appendChild(b);a=[statCounter.ALL_ID].concat(this.sortBy(getKeys(a),c));for(c=0;c<a.length;c++){var j=a[c];sdata=statCounter.getStatData(j);udata=statCounter.getUserData(j);var e=ce("tr",{id:"mess"+j}),
f=ce("td",{innerHTML:j==statCounter.ALL_ID?"":c},{textAlign:"center",width:"30px"}),d=ce("td",{innerHTML:'<div class=""></div><input type="hidden" id="post_check_'+j+'">',className:"mail_check"});d.setAttribute("onmouseover","mail.checkOver(this, '"+j+"')");d.setAttribute("onmouseout","mail.checkOut(this, '"+j+"')");d.setAttribute("onclick","myCheckChange(this, '"+j+"')");var h=ce("td",{innerHTML:j==statCounter.ALL_ID?"":'<a href="/id'+j+'" target="_blank"><img src="'+udata.photo+'" /></a>',className:"messagePicture"}),
j=ce("td",{innerHTML:(j==statCounter.ALL_ID?"":'<a href="/id'+j+'" target="_blank">')+udata.first_name+" "+udata.last_name+(j==statCounter.ALL_ID?"":"</a>"),className:"messageFrom"}),g=ce("td",{innerHTML:sdata.inM+sdata.outM}),i=ce("td",{innerHTML:sdata.outM}),l=ce("td",{innerHTML:sdata.inM});if(user.kbytes)var m=ce("td",{innerHTML:sdata.inSize+sdata.outSize}),n=ce("td",{innerHTML:sdata.outSize}),o=ce("td",{innerHTML:sdata.inSize});var k=ce("td",{innerHTML:'<a href="mail.php?act=show&id='+sdata.lastMessageId+
'" target="_blank">'+formatDate(new Date(sdata.lastMessageDate*1E3))+"</a>"});e.appendChild(d);e.appendChild(f);e.appendChild(h);e.appendChild(j);e.appendChild(g);e.appendChild(i);e.appendChild(l);user.kbytes&&(e.appendChild(m),e.appendChild(n),e.appendChild(o));e.appendChild(k);b.appendChild(e)}},sort:function(a){this.displayStats(statCounter.statByUser,statCounter.userData,a)},requestSettings:function(){this.setHeader(user.lang.appName+" "+SYS.VERSION);ui.clearContent();this.removeLoggerPane();
var a=new MessageBox({title:user.lang.settingsText});a.addButton(user.lang.startButton,function(){a.hide();messageProcessor.start()});var b='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_verbose" /></div>';b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_kbytes" /></div>';b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_sort_kbytes" /></div>';b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_friends_only" /></div>';
b+='<div style="width: 300px; height: 30px;"><input type="hidden" id="param_fancy_graphs" /></div>';a.content(b).show();new Checkbox(ge("param_verbose"),{label:user.lang.verbose,checked:0,onChange:function(){user.verbose=!user.verbose}});new Checkbox(ge("param_kbytes"),{label:user.lang.kbytes,checked:1,onChange:function(){user.kbytes=!user.kbytes}});new Checkbox(ge("param_sort_kbytes"),{label:user.lang.sortByKBytes,checked:0,onChange:function(){user.sortByKBytes=!user.sortByKBytes}});new Checkbox(ge("param_friends_only"),
{label:user.lang.friendsOnly,checked:0,onChange:function(){user.friendsOnly=!user.friendsOnly}});new Checkbox(ge("param_fancy_graphs"),{label:user.lang.wantToPlotGraphs,checked:1,onChange:function(){user.plotGraphs=!user.plotGraphs}})},addLoggerPane:function(){var a=ce("textarea",{cols:80,rows:20,id:"loggerPane"},{fontFamily:"Courier new"});insertAfter(a,ge("content"))},removeLoggerPane:function(){var a=ge("loggerPane");a!=void 0&&a.parentNode.removeChild(a)},onNoteNotCreated:function(){ge("mail_top_msg").innerHTML=
"<div>"+user.lang.noteFailure+"</div>";show("mail_top_msg")},onNoteCreated:function(a){ge("mail_top_msg").innerHTML="<div>"+user.lang.noteSuccess+'. <a href="/note'+user.uid+"_"+a+'" target="_blank">'+user.lang.seeNote+"</a></div>";show("mail_top_msg")},sentColors:[6806590,15976256,15747131],receivedColors:[8374630,15584101,15754329],plotGraph:function(a){ge("graph").style.display="";var b={isRTL:window.is_rtl,"lang.select_graphs":fixQuot("filter"),"lang.months":fixQuot("January,February,March,April,May,June,July,August,September,October,November,December"),
"lang.dayMonths":fixQuot("January,February,March,April,May,June,July,August,September,October,November,December"),"lang.dateFormats.day_fullmon_year_hour":fixQuot("{day} {dayMonth} {year}, {hour12}:00"),"lang.dateFormats.day_fullmon_year":fixQuot("{month} {day}, {year}"),"lang.dateFormats.day_mon":fixQuot("{day} {month}"),"lang.dateFormats.day_fullmon":fixQuot("{day} {month}"),"lang.loading":fixQuot("Loading..."),"lang.no_data":fixQuot("No input data"),"lang.data_empty":fixQuot("Input data is empty"),
"lang.error_loading":fixQuot("Loading error")};flashVars=clone(b);for(var b=ge("mail_rows_t"),c="[",e=0,f=0;f<b.rows.length;++f){var j=b.rows[f];if((j=j.id?intval(j.id.replace(/^mess/,"")):0)&&cur.messChecked[j]){e>0&&(c+=",");if(a)var d=0,h=0,g='{"c": '+this.receivedColors[e]+',"f": 0, "d": [',i='{"c": '+this.sentColors[e]+',"f": 0, "d": [';else var l=0,m=0,n='{"c": '+this.sentColors[e]+',"f": 0, "d": [',o='{"c": '+this.receivedColors[e]+',"f": 0, "d": [';for(var k in statCounter.getStatData(j).history){var p=
statCounter.getStatData(j).history[k];a?(d+=p.outSize,h+=p.inSize,i+="["+k+","+d+"],",g+="["+k+","+h+"],"):(l+=p.outM,m+=p.inM,n+="["+k+","+l+"],",o+="["+k+","+m+"],")}a?(i+="["+statCounter.lastMessageTime+","+d+']], "name": "'+statCounter.getUserData(j).first_name+" "+statCounter.getUserData(j).last_name+": "+user.lang.sentCol+'"}',g+="["+statCounter.lastMessageTime+","+h+']], "name": "'+statCounter.getUserData(j).first_name+" "+statCounter.getUserData(j).last_name+": "+user.lang.receivedCol+'"}',
c+=i+","+g):(n+="["+statCounter.lastMessageTime+","+l+']], "name": "'+statCounter.getUserData(j).first_name+" "+statCounter.getUserData(j).last_name+": "+user.lang.sentCol+'"}',o+="["+statCounter.lastMessageTime+","+m+']], "name": "'+statCounter.getUserData(j).first_name+" "+statCounter.getUserData(j).last_name+": "+user.lang.receivedCol+'"}',c+=n+","+o);e++}}flashVars.graphdata=fixQuot(c+"]");user.verbose&&SYS.log("plotting: "+flashVars.graphdata);flashVars.div_id="graph";renderFlash("graph",{url:"/swf/graph.swf?0.28",
id:"graph",width:"100%",height:400,version:8},{allowfullscreen:"true"},flashVars)}},statCounter={statByUser:{},userData:{},lastMessageTime:0,overallStats:{inM:0,outM:0,lastMessageDate:0,lastMessageId:0,inSize:0,outSize:0,history:{}},ALL_ID:-1,createEmptyStatsFor:function(a){var b={inM:0,outM:0,lastMessageDate:a.date,lastMessageId:a.mid,inSize:0,outSize:0,history:{}};return this.statByUser[a.uid]=b},updateStats:function(a,b){if(b.lastMessageDate<a.date)b.lastMessageDate=a.date,b.lastMessageId=a.mid;
if(statCounter.lastMessageTime<a.date)statCounter.lastMessageTime=a.date;a.out?(b.outM++,b.outSize+=a.body.length):(b.inM++,b.inSize+=a.body.length);user.plotGraphs&&(b.history[a.date]={inM:a.out?0:1,outM:a.out?1:0,inSize:a.out?0:a.body.length,outSize:a.out?a.body.length:0})},processSingleMessage:function(a){userStats=this.statByUser[a.uid];userStats==void 0&&(userStats=this.createEmptyStatsFor(a));this.updateStats(a,userStats);this.updateStats(a,this.overallStats)},getStatData:function(a){if(a==
this.ALL_ID)return this.overallStats;return this.statByUser[a]},getUserData:function(a){if(a==this.ALL_ID)return{first_name:user.lang.totalFirstName,last_name:user.lang.totalLastName};return this.userData[a]==void 0?{first_name:"DELETED",last_name:"DELETED"}:this.userData[a]},generateNoteContents:function(){var a="[[club21792535|vkontakte-stats]]\n\n";a+="{|\n";a+="|-\n";a+="! ";a+="!! "+user.lang.nameCol;a+="!! "+user.lang.numberOfMessagesCol;a+="!! "+user.lang.sentCol;a+="!! "+user.lang.receivedCol;
user.kbytes&&(a+="!! "+user.lang.symbolsCol,a+="!! "+user.lang.sentSymbolsCol,a+="!! "+user.lang.receivedSymbolsCol);a+="\n";for(var b=0,c=ge("mail_rows_t"),e=0;e<c.rows.length;++e){var f=c.rows[e],f=f.id?f.id.replace(/^mess/,""):0;f!=0&&(f!=this.ALL_ID&&b++,cur.messChecked[f]&&(sdata=this.getStatData(f),udata=this.getUserData(f),a+="|-\n",a+="| "+(f!=this.ALL_ID?b:"")+"\n",a+="| [[id"+f+"|"+udata.first_name+" "+udata.last_name+"]]\n",a+="| "+(sdata.inM+sdata.outM)+"\n",a+="| "+sdata.outM+"\n",a+=
"| "+sdata.inM+"\n",user.kbytes&&(a+="| "+(sdata.inSize+sdata.outSize)+"\n",a+="| "+sdata.outSize+"\n",a+="| "+sdata.inSize+"\n")))}a+="|}\n";return a},exportToNote:function(){apiConnector.createNote(user.lang.appName,this.generateNoteContents(),function(a,b){var c=eval("("+b+")");c.response==void 0?(SYS.log("Note creationg failed!"+b),ui.onNoteNotCreated()):(c=c.response.nid,user.verbose&&SYS.log("Note created: "+c),ui.onNoteCreated(c))})}},messageProcessor={incomingMessages:void 0,processedIncomingMessages:0,
outgoingMessages:void 0,processedOutgoingMessages:0,failed:0,onUserProfilesLoaded:function(a){var b=eval("("+a+")");b.response==void 0&&SYS.fatal(a);b=b.response;for(a=0;a<b.length;a++)statCounter.userData[b[a].uid]=b[a];this.pendingUserDataRequests--;user.verbose&&SYS.log("Got user profile data, "+this.pendingUserDataRequest+" goes remaining");this.pendingUserDataRequests<=0&&(ui.setHeader(user.lang.done+"!"),ui.displayStats(statCounter.statByUser,statCounter.userData,user.kbytes&&user.sortByKBytes?
"tot-size":"tot"))},onAllMessagesLoaded:function(){ui.updateProgressBar(this.processedIncomingMessages,this.incomingMessages,this.processedOutgoingMessages,this.outgoingMessages);ui.setHeader(user.lang.gettingNames+"...");user.verbose&&SYS.log("Got all messages, getting user names");this.api.getUserNames(getKeys(statCounter.statByUser),function(a,b){messageProcessor.onUserProfilesLoaded(b)})},onMessagesLoaded:function(a,b){var c=0;if(a==void 0)this.failed+=SYS.MESSAGES_PER_REQUEST,SYS.log("Skipping "+
SYS.MESSAGES_PER_REQUEST+" messages..."),b?this.processedOutgoingMessages+=SYS.MESSAGES_PER_REQUEST:this.processedIncomingMessages+=SYS.MESSAGES_PER_REQUEST,c=this.offset+SYS.MESSAGES_PER_REQUEST;else if(a.response!=void 0){var c=a.response,e=c[0];user.verbose&&SYS.log("Got "+(c.length-1)+" messages");for(var f=1;f<c.length;f++)statCounter.processSingleMessage(c[f]);if(b){if(this.processedOutgoingMessages+=c.length-1,c=this.processedOutgoingMessages+(e-this.outgoingMessages),e!=this.outgoingMessages&&
user.verbose&&SYS.log("By the way, the user has sent "+(e-this.outgoingMessages)+" message(s) after the script was started"),c>=e||SYS.DEBUG&&c>=SYS.MESSAGES_TO_PROCESS_IN_DEBUG_MODE){this.onAllMessagesLoaded();return}}else if(this.processedIncomingMessages+=c.length-1,c=this.processedIncomingMessages+(e-this.incomingMessages),e!=this.incomingMessages&&user.verbose&&SYS.log("By the way, the user has received "+(e-this.incomingMessages)+" message(s) after the script was started"),c>=e||SYS.DEBUG&&
c>=SYS.MESSAGES_TO_PROCESS_IN_DEBUG_MODE)b=1,c=0;ui.updateProgressBar(this.processedIncomingMessages,this.incomingMessages,this.processedOutgoingMessages,this.outgoingMessages)}else b=this.out,c=this.offset;e=(new Date).getTime()-this.requestStartTime;user.verbose&&SYS.log("Elapsed time:  "+e+" ms");e>=SYS.MSEC_BETWEEN_REQUESTS?(user.verbose&&SYS.log("Starting new request..."),this.requestStartTime=(new Date).getTime(),this.api.getMessages(b,c,SYS.MESSAGES_PER_REQUEST,function(a){messageProcessor.onMessagesLoaded(a,
b)})):(this.out=b,this.offset=c,user.verbose&&SYS.log("Scheduling new request in "+(SYS.MSEC_BETWEEN_REQUESTS-e)+"ms"),setTimeout("messageProcessor.requestStartTime = (new Date()).getTime(); messageProcessor.api.getMessages(messageProcessor.out, messageProcessor.offset, SYS.MESSAGES_PER_REQUEST, function(response) {messageProcessor.onMessagesLoaded(response, messageProcessor.out)});",SYS.MSEC_BETWEEN_REQUESTS-e))},startProcessingMessages:function(){ui.setHeader(user.lang.processingMessages+"...");
ui.createProgressBar(user.lang.processingMessages+"...");ui.updateProgressBar(0,this.incomingMessages,0,this.outgoingMessages);this.requestStartTime=(new Date).getTime();this.api.getMessages(0,0,SYS.MESSAGES_PER_REQUEST,function(a){messageProcessor.onMessagesLoaded(a,0)})},onMessageNumbersLoaded:function(a,b){var c=a.response;user.verbose&&SYS.log("Loaded message numbers ["+b+"]: "+c[0]);b?this.outgoingMessages=c[0]:this.incomingMessages=c[0];this.incomingMessages!=void 0&&this.outgoingMessages!=
void 0&&setTimeout(function(){messageProcessor.startProcessingMessages()},SYS.MSEC_BETWEEN_REQUESTS)},getNumberOfMessages:function(){this.api.getMessages(0,0,1,function(a){messageProcessor.onMessageNumbersLoaded(a,0)});setTimeout(function(){apiConnector.getMessages(1,0,1,function(a){messageProcessor.onMessageNumbersLoaded(a,1)})},SYS.MSEC_BETWEEN_REQUESTS*2)},start:function(){this.api=apiConnector;user.verbose&&(ui.addLoggerPane(),SYS.log("Started"));ui.setHeader(user.lang.loadingMessageNumbers);
this.getNumberOfMessages()}};
function Ajax(a,b,c){var e=this;this.onDone=a;this.onFail=b;var f=null;try{f=new XMLHttpRequest}catch(j){f=null}if(!f)try{f||(f=new ActiveXObject("Msxml2.XMLHTTP"))}catch(d){f=null}if(!f)try{f||(f=new ActiveXObject("Microsoft.XMLHTTP"))}catch(h){f=null}var g=function(a,b){if(f.readyState==4)if(f.status>=200&&f.status<300){if(c&&i(),e.onDone)e.onDone(extend(e,{url:a,data:b}),f.responseText)}else if(e.status=f.status,e.readyState=f.readyState,e.onFail)e.onFail(extend(e,{url:a,data:b}),f.responseText)},
i=function(){if(f&&f.responseText){var a=f.responseText.replace(/^[\s\n]+/g,"");if(a.substr(0,10)=="<noscript>")try{var b=a.substr(10).split("</noscript>");eval(b[0]);f.responseText=b[1]}catch(c){debugLog("eval ajax script:"+c.message)}}};this.get=function(a,b,c){f.onreadystatechange=function(){g(a,b)};var c=c||!1,d=typeof b!="string"?ajx2q(b):b;a+=d?"?"+d:"";f.open("GET",a,!c);f.setRequestHeader("X-Requested-With","XMLHttpRequest");f.send("")};this.post=function(a,b,c){f.onreadystatechange=function(){g(a,
b)};var c=c||!1,d=typeof b!="string"?ajx2q(b):b;try{f.open("POST",a,!c)}catch(e){debugLog("ajax post error: "+e.message)}f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.setRequestHeader("X-Requested-With","XMLHttpRequest");f.send(d)}}
var apiConnector={API_ADDRESS:"/api.php",API_VERSION:"3.0",LOGON_FAIL_STRING:"login_fail",LOGON_SUCCESS_STRING:"login_success",NOT_USED_SETTING:32768,logon:function(a,b){this.appId=a;this.settings=b;var c=ce("iframe",{src:"/login.php?app="+a+"&layout=popup&type=browser&settings="+b},{position:"relative",width:"100%",height:"500px"});c.setAttribute("onload","apiConnector.onLogonFrameLoaded()");ui.setHeader(user.lang.authorizing+"...");ui.clearContent();ui.appendContentElement(c)},onLogonFrameLoaded:function(){var a=
new Ajax,b=function(a,b){var f="{"+b.split("app_session = {")[1].split("}")[0]+"}";sessionInfo=eval("("+f+")");user.uid=sessionInfo.mid;apiConnector.secret=sessionInfo.secret;apiConnector.sid=sessionInfo.sid;ui.setHeader(user.lang.authorized);ui.clearContent();ui.requestSettings()};a.onDone=function(c,e){if(e.indexOf("Login failure")!=-1)SYS.fatal("failed to log on. ");else if(e.indexOf("Login success")!=-1)a.onDone=b,a.get("/login.php?app="+apiConnector.appId+"&layout=popup&type=browser&settings="+
apiConnector.NOT_USED_SETTING)};a.get("/login.php?app="+apiConnector.appId+"&layout=popup&type=browser&settings="+apiConnector.settings)},getMessages:function(a,b,c,e){user.verbose&&SYS.log("getMessages invoked: out="+a+"; offset="+b);var f=user.uid,j=user.kbytes?0:1;f+="api_id="+this.appId;f+="count="+c;user.friendsOnly&&(f+="filters=4");f+="format=JSON";f+="method=messages.get";f+="offset="+b;f+="out="+a;f+="preview_length="+j;f+="v="+this.API_VERSION;f+=this.secret;var d=new Ajax;d.onDone=function(a,
b){var c;try{c=eval("("+b+")")}catch(d){SYS.log("Failed to parse JSON response: ["+d+"] "+b)}c==void 0?e():c.error!=void 0?c.error.error_code==SYS.TOO_MANY_REQUESTS_ERR_CODE?(user.verbose&&SYS.log("too many requests: "+b),e({})):SYS.fatal(b):e(c)};params={api_id:apiConnector.appId,count:c,format:"JSON",method:"messages.get",offset:b,out:a,preview_length:j,sid:apiConnector.sid,sig:md5(f),v:this.API_VERSION};if(user.friendsOnly)params.filters=4;d.post(this.API_ADDRESS,params)},doGetUserData:function(a,
b){user.verbose&&SYS.log("doGetUserData invoked: ids="+a);var c=user.uid;c+="api_id="+this.appId;c+="fields=photo";c+="format=JSON";c+="method=getProfiles";var e=a.join(",");c+="uids="+e;c+="v="+this.API_VERSION;c+=this.secret;var f=new Ajax;f.onDone=b;f.post(this.API_ADDRESS,{api_id:apiConnector.appId,fields:"photo",format:"JSON",method:"getProfiles",sid:apiConnector.sid,sig:md5(c),uids:e,v:this.API_VERSION})},getUserNames:function(a,b){a=splitArrayToSubArrays(a,SYS.MAX_USERS_PER_REQUEST);this.onDone=
b;messageProcessor.pendingUserDataRequests=a.length;for(var c=0;c<a.length;c++)setTimeout("apiConnector.doGetUserData(["+a[c]+"], apiConnector.onDone)",(c+1)*SYS.MSEC_BETWEEN_REQUESTS_FOR_USERDATA)},createNote:function(a,b,c){user.verbose&&SYS.log("createNote invoked: title="+a+"; text="+b);var e=user.uid;e+="api_id="+this.appId;e+="format=JSON";e+="method=notes.add";e+="text="+b;e+="title="+a;e+="v="+this.API_VERSION;e+=this.secret;var f=new Ajax;f.onDone=c;f.post(this.API_ADDRESS,{api_id:apiConnector.appId,
format:"JSON",method:"notes.add",sid:apiConnector.sid,sig:md5(e),text:b,title:a,v:this.API_VERSION})}};window.renderFlash?stManager.add(SYS.FILES_TO_LOAD,function(){apiConnector.logon(SYS.APP_ID,SYS.LOGIN_SETTING)}):alert(user.lang.wrongPage);